var e=(e,t,s)=>new Promise((r,n)=>{var i=e=>{try{a(s.next(e))}catch(t){n(t)}},o=e=>{try{a(s.throw(e))}catch(t){n(t)}},a=e=>e.done?r(e.value):Promise.resolve(e.value).then(i,o);a((s=s.apply(e,t)).next())});import{b as t,g as s}from"./vendor-DRjIecBf.js";const r={},n=function(e,t,s){let n=Promise.resolve();if(t&&t.length>0){let e=function(e){return Promise.all(e.map(e=>Promise.resolve(e).then(e=>({status:"fulfilled",value:e}),e=>({status:"rejected",reason:e}))))};document.getElementsByTagName("link");const s=document.querySelector("meta[property=csp-nonce]"),i=(null==s?void 0:s.nonce)||(null==s?void 0:s.getAttribute("nonce"));n=e(t.map(e=>{if((e=function(e){return"/"+e}(e))in r)return;r[e]=!0;const t=e.endsWith(".css"),s=t?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${s}`))return;const n=document.createElement("link");return n.rel=t?"stylesheet":"modulepreload",t||(n.as="script"),n.crossOrigin="",n.href=e,i&&n.setAttribute("nonce",i),document.head.appendChild(n),t?new Promise((t,s)=>{n.addEventListener("load",t),n.addEventListener("error",()=>s(new Error(`Unable to preload CSS for ${e}`)))}):void 0}))}function i(e){const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}return n.then(t=>{for(const e of t||[])"rejected"===e.status&&i(e.reason);return e().catch(i)})};class i extends Error{constructor(e,t="FunctionsError",s){super(e),this.name=t,this.context=s}}class o extends i{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class a extends i{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class l extends i{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var u,h;(h=u||(u={})).Any="any",h.ApNortheast1="ap-northeast-1",h.ApNortheast2="ap-northeast-2",h.ApSouth1="ap-south-1",h.ApSoutheast1="ap-southeast-1",h.ApSoutheast2="ap-southeast-2",h.CaCentral1="ca-central-1",h.EuCentral1="eu-central-1",h.EuWest1="eu-west-1",h.EuWest2="eu-west-2",h.EuWest3="eu-west-3",h.SaEast1="sa-east-1",h.UsEast1="us-east-1",h.UsWest1="us-west-1",h.UsWest2="us-west-2";var c=function(e,t,s,r){return new(s||(s=Promise))(function(n,i){function o(e){try{l(r.next(e))}catch(t){i(t)}}function a(e){try{l(r.throw(e))}catch(t){i(t)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s(function(e){e(t)})).then(o,a)}l((r=r.apply(e,t||[])).next())})};class d{constructor(t,{headers:s={},customFetch:r,region:i=u.Any}={}){this.url=t,this.headers=s,this.region=i,this.fetch=(t=>{let s;return s=t||("undefined"==typeof fetch?(...t)=>n(()=>e(null,null,function*(){const{default:e}=yield Promise.resolve().then(()=>j);return{default:e}}),void 0).then(({default:e})=>e(...t)):fetch),(...e)=>s(...e)})(r)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,t={}){var s;return c(this,void 0,void 0,function*(){try{const{headers:r,method:n,body:i}=t;let u={},{region:h}=t;h||(h=this.region);const c=new URL(`${this.url}/${e}`);let d;h&&"any"!==h&&(u["x-region"]=h,c.searchParams.set("forceFunctionRegion",h)),i&&(r&&!Object.prototype.hasOwnProperty.call(r,"Content-Type")||!r)&&("undefined"!=typeof Blob&&i instanceof Blob||i instanceof ArrayBuffer?(u["Content-Type"]="application/octet-stream",d=i):"string"==typeof i?(u["Content-Type"]="text/plain",d=i):"undefined"!=typeof FormData&&i instanceof FormData?d=i:(u["Content-Type"]="application/json",d=JSON.stringify(i)));const f=yield this.fetch(c.toString(),{method:n||"POST",headers:Object.assign(Object.assign(Object.assign({},u),this.headers),r),body:d}).catch(e=>{throw new o(e)}),p=f.headers.get("x-relay-error");if(p&&"true"===p)throw new a(f);if(!f.ok)throw new l(f);let g,y=(null!==(s=f.headers.get("Content-Type"))&&void 0!==s?s:"text/plain").split(";")[0].trim();return g="application/json"===y?yield f.json():"application/octet-stream"===y?yield f.blob():"text/event-stream"===y?f:"multipart/form-data"===y?yield f.formData():yield f.text(),{data:g,error:null,response:f}}catch(r){return{data:null,error:r,response:r instanceof l||r instanceof a?r.context:void 0}}})}}var f={},p={},g={},y={},v={},m={},_=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw new Error("unable to locate global object")}();const b=_.fetch,w=_.fetch.bind(_),k=_.Headers,S=_.Request,T=_.Response,j=Object.freeze(Object.defineProperty({__proto__:null,Headers:k,Request:S,Response:T,default:w,fetch:b},Symbol.toStringTag,{value:"Module"})),E=t(j);var P,O,$,A,C,I={};function R(){if(P)return I;P=1,Object.defineProperty(I,"__esModule",{value:!0});class e extends Error{constructor(e){super(e.message),this.name="PostgrestError",this.details=e.details,this.hint=e.hint,this.code=e.code}}return I.default=e,I}function x(){if(O)return m;O=1;var t=m&&m.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(m,"__esModule",{value:!0});const s=t(E),r=t(R());return m.default=class{constructor(e){this.shouldThrowOnError=!1,this.method=e.method,this.url=e.url,this.headers=e.headers,this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=e.shouldThrowOnError,this.signal=e.signal,this.isMaybeSingle=e.isMaybeSingle,e.fetch?this.fetch=e.fetch:"undefined"==typeof fetch?this.fetch=s.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(e,t){return this.headers=Object.assign({},this.headers),this.headers[e]=t,this}then(t,s){void 0===this.schema||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),"GET"!==this.method&&"HEAD"!==this.method&&(this.headers["Content-Type"]="application/json");let n=(0,this.fetch)(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(t=>e(this,null,function*(){var e,s,n;let i=null,o=null,a=null,l=t.status,u=t.statusText;if(t.ok){if("HEAD"!==this.method){const e=yield t.text();""===e||(o="text/csv"===this.headers.Accept||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?e:JSON.parse(e))}const r=null===(e=this.headers.Prefer)||void 0===e?void 0:e.match(/count=(exact|planned|estimated)/),n=null===(s=t.headers.get("content-range"))||void 0===s?void 0:s.split("/");r&&n&&n.length>1&&(a=parseInt(n[1])),this.isMaybeSingle&&"GET"===this.method&&Array.isArray(o)&&(o.length>1?(i={code:"PGRST116",details:`Results contain ${o.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},o=null,a=null,l=406,u="Not Acceptable"):o=1===o.length?o[0]:null)}else{const e=yield t.text();try{i=JSON.parse(e),Array.isArray(i)&&404===t.status&&(o=[],i=null,l=200,u="OK")}catch(h){404===t.status&&""===e?(l=204,u="No Content"):i={message:e}}if(i&&this.isMaybeSingle&&(null===(n=null==i?void 0:i.details)||void 0===n?void 0:n.includes("0 rows"))&&(i=null,l=200,u="OK"),i&&this.shouldThrowOnError)throw new r.default(i)}return{error:i,data:o,count:a,status:l,statusText:u}}));return this.shouldThrowOnError||(n=n.catch(e=>{var t,s,r;return{error:{message:`${null!==(t=null==e?void 0:e.name)&&void 0!==t?t:"FetchError"}: ${null==e?void 0:e.message}`,details:`${null!==(s=null==e?void 0:e.stack)&&void 0!==s?s:""}`,hint:"",code:`${null!==(r=null==e?void 0:e.code)&&void 0!==r?r:""}`},data:null,count:null,status:0,statusText:""}})),n.then(t,s)}returns(){return this}overrideTypes(){return this}},m}function U(){if($)return v;$=1;var e=v&&v.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(v,"__esModule",{value:!0});const t=e(x());class s extends t.default{select(e){let t=!1;const s=(null!=e?e:"*").split("").map(e=>/\s/.test(e)&&!t?"":('"'===e&&(t=!t),e)).join("");return this.url.searchParams.set("select",s),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(e,{ascending:t=!0,nullsFirst:s,foreignTable:r,referencedTable:n=r}={}){const i=n?`${n}.order`:"order",o=this.url.searchParams.get(i);return this.url.searchParams.set(i,`${o?`${o},`:""}${e}.${t?"asc":"desc"}${void 0===s?"":s?".nullsfirst":".nullslast"}`),this}limit(e,{foreignTable:t,referencedTable:s=t}={}){const r=void 0===s?"limit":`${s}.limit`;return this.url.searchParams.set(r,`${e}`),this}range(e,t,{foreignTable:s,referencedTable:r=s}={}){const n=void 0===r?"offset":`${r}.offset`,i=void 0===r?"limit":`${r}.limit`;return this.url.searchParams.set(n,`${e}`),this.url.searchParams.set(i,""+(t-e+1)),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return"GET"===this.method?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:e=!1,verbose:t=!1,settings:s=!1,buffers:r=!1,wal:n=!1,format:i="text"}={}){var o;const a=[e?"analyze":null,t?"verbose":null,s?"settings":null,r?"buffers":null,n?"wal":null].filter(Boolean).join("|"),l=null!==(o=this.headers.Accept)&&void 0!==o?o:"application/json";return this.headers.Accept=`application/vnd.pgrst.plan+${i}; for="${l}"; options=${a};`,this}rollback(){var e;return(null!==(e=this.headers.Prefer)&&void 0!==e?e:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}}return v.default=s,v}function L(){if(A)return y;A=1;var e=y&&y.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(y,"__esModule",{value:!0});const t=e(U());class s extends t.default{eq(e,t){return this.url.searchParams.append(e,`eq.${t}`),this}neq(e,t){return this.url.searchParams.append(e,`neq.${t}`),this}gt(e,t){return this.url.searchParams.append(e,`gt.${t}`),this}gte(e,t){return this.url.searchParams.append(e,`gte.${t}`),this}lt(e,t){return this.url.searchParams.append(e,`lt.${t}`),this}lte(e,t){return this.url.searchParams.append(e,`lte.${t}`),this}like(e,t){return this.url.searchParams.append(e,`like.${t}`),this}likeAllOf(e,t){return this.url.searchParams.append(e,`like(all).{${t.join(",")}}`),this}likeAnyOf(e,t){return this.url.searchParams.append(e,`like(any).{${t.join(",")}}`),this}ilike(e,t){return this.url.searchParams.append(e,`ilike.${t}`),this}ilikeAllOf(e,t){return this.url.searchParams.append(e,`ilike(all).{${t.join(",")}}`),this}ilikeAnyOf(e,t){return this.url.searchParams.append(e,`ilike(any).{${t.join(",")}}`),this}is(e,t){return this.url.searchParams.append(e,`is.${t}`),this}in(e,t){const s=Array.from(new Set(t)).map(e=>"string"==typeof e&&new RegExp("[,()]").test(e)?`"${e}"`:`${e}`).join(",");return this.url.searchParams.append(e,`in.(${s})`),this}contains(e,t){return"string"==typeof t?this.url.searchParams.append(e,`cs.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cs.{${t.join(",")}}`):this.url.searchParams.append(e,`cs.${JSON.stringify(t)}`),this}containedBy(e,t){return"string"==typeof t?this.url.searchParams.append(e,`cd.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cd.{${t.join(",")}}`):this.url.searchParams.append(e,`cd.${JSON.stringify(t)}`),this}rangeGt(e,t){return this.url.searchParams.append(e,`sr.${t}`),this}rangeGte(e,t){return this.url.searchParams.append(e,`nxl.${t}`),this}rangeLt(e,t){return this.url.searchParams.append(e,`sl.${t}`),this}rangeLte(e,t){return this.url.searchParams.append(e,`nxr.${t}`),this}rangeAdjacent(e,t){return this.url.searchParams.append(e,`adj.${t}`),this}overlaps(e,t){return"string"==typeof t?this.url.searchParams.append(e,`ov.${t}`):this.url.searchParams.append(e,`ov.{${t.join(",")}}`),this}textSearch(e,t,{config:s,type:r}={}){let n="";"plain"===r?n="pl":"phrase"===r?n="ph":"websearch"===r&&(n="w");const i=void 0===s?"":`(${s})`;return this.url.searchParams.append(e,`${n}fts${i}.${t}`),this}match(e){return Object.entries(e).forEach(([e,t])=>{this.url.searchParams.append(e,`eq.${t}`)}),this}not(e,t,s){return this.url.searchParams.append(e,`not.${t}.${s}`),this}or(e,{foreignTable:t,referencedTable:s=t}={}){const r=s?`${s}.or`:"or";return this.url.searchParams.append(r,`(${e})`),this}filter(e,t,s){return this.url.searchParams.append(e,`${t}.${s}`),this}}return y.default=s,y}function D(){if(C)return g;C=1;var e=g&&g.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(g,"__esModule",{value:!0});const t=e(L());return g.default=class{constructor(e,{headers:t={},schema:s,fetch:r}){this.url=e,this.headers=t,this.schema=s,this.fetch=r}select(e,{head:s=!1,count:r}={}){const n=s?"HEAD":"GET";let i=!1;const o=(null!=e?e:"*").split("").map(e=>/\s/.test(e)&&!i?"":('"'===e&&(i=!i),e)).join("");return this.url.searchParams.set("select",o),r&&(this.headers.Prefer=`count=${r}`),new t.default({method:n,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(e,{count:s,defaultToNull:r=!0}={}){const n=[];if(this.headers.Prefer&&n.push(this.headers.Prefer),s&&n.push(`count=${s}`),r||n.push("missing=default"),this.headers.Prefer=n.join(","),Array.isArray(e)){const t=e.reduce((e,t)=>e.concat(Object.keys(t)),[]);if(t.length>0){const e=[...new Set(t)].map(e=>`"${e}"`);this.url.searchParams.set("columns",e.join(","))}}return new t.default({method:"POST",url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}upsert(e,{onConflict:s,ignoreDuplicates:r=!1,count:n,defaultToNull:i=!0}={}){const o=[`resolution=${r?"ignore":"merge"}-duplicates`];if(void 0!==s&&this.url.searchParams.set("on_conflict",s),this.headers.Prefer&&o.push(this.headers.Prefer),n&&o.push(`count=${n}`),i||o.push("missing=default"),this.headers.Prefer=o.join(","),Array.isArray(e)){const t=e.reduce((e,t)=>e.concat(Object.keys(t)),[]);if(t.length>0){const e=[...new Set(t)].map(e=>`"${e}"`);this.url.searchParams.set("columns",e.join(","))}}return new t.default({method:"POST",url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}update(e,{count:s}={}){const r=[];return this.headers.Prefer&&r.push(this.headers.Prefer),s&&r.push(`count=${s}`),this.headers.Prefer=r.join(","),new t.default({method:"PATCH",url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}delete({count:e}={}){const s=[];return e&&s.push(`count=${e}`),this.headers.Prefer&&s.unshift(this.headers.Prefer),this.headers.Prefer=s.join(","),new t.default({method:"DELETE",url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}},g}var N,q,B,M,F={},K={};function z(){if(q)return F;q=1,Object.defineProperty(F,"__esModule",{value:!0}),F.DEFAULT_HEADERS=void 0;const e=(N||(N=1,Object.defineProperty(K,"__esModule",{value:!0}),K.version=void 0,K.version="0.0.0-automated"),K);return F.DEFAULT_HEADERS={"X-Client-Info":`postgrest-js/${e.version}`},F}const W=s(function(){if(M)return f;M=1;var e=f&&f.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(f,"__esModule",{value:!0}),f.PostgrestError=f.PostgrestBuilder=f.PostgrestTransformBuilder=f.PostgrestFilterBuilder=f.PostgrestQueryBuilder=f.PostgrestClient=void 0;const t=e(function(){if(B)return p;B=1;var e=p&&p.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(p,"__esModule",{value:!0});const t=e(D()),s=e(L()),r=z();class n{constructor(e,{headers:t={},schema:s,fetch:n}={}){this.url=e,this.headers=Object.assign(Object.assign({},r.DEFAULT_HEADERS),t),this.schemaName=s,this.fetch=n}from(e){const s=new URL(`${this.url}/${e}`);return new t.default(s,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(e){return new n(this.url,{headers:this.headers,schema:e,fetch:this.fetch})}rpc(e,t={},{head:r=!1,get:n=!1,count:i}={}){let o;const a=new URL(`${this.url}/rpc/${e}`);let l;r||n?(o=r?"HEAD":"GET",Object.entries(t).filter(([e,t])=>void 0!==t).map(([e,t])=>[e,Array.isArray(t)?`{${t.join(",")}}`:`${t}`]).forEach(([e,t])=>{a.searchParams.append(e,t)})):(o="POST",l=t);const u=Object.assign({},this.headers);return i&&(u.Prefer=`count=${i}`),new s.default({method:o,url:a,headers:u,schema:this.schemaName,body:l,fetch:this.fetch,allowEmpty:!1})}}return p.default=n,p}());f.PostgrestClient=t.default;const s=e(D());f.PostgrestQueryBuilder=s.default;const r=e(L());f.PostgrestFilterBuilder=r.default;const n=e(U());f.PostgrestTransformBuilder=n.default;const i=e(x());f.PostgrestBuilder=i.default;const o=e(R());return f.PostgrestError=o.default,f.default={PostgrestClient:t.default,PostgrestQueryBuilder:s.default,PostgrestFilterBuilder:r.default,PostgrestTransformBuilder:n.default,PostgrestBuilder:i.default,PostgrestError:o.default},f}()),{PostgrestClient:J,PostgrestQueryBuilder:H,PostgrestFilterBuilder:G,PostgrestTransformBuilder:V,PostgrestBuilder:Y,PostgrestError:Q}=W;const X=function(){if("undefined"!=typeof WebSocket)return WebSocket;if(void 0!==global.WebSocket)return global.WebSocket;if(void 0!==window.WebSocket)return window.WebSocket;if(void 0!==self.WebSocket)return self.WebSocket;throw new Error("`WebSocket` is not supported in this environment")}();var Z,ee,te,se,re,ne,ie,oe,ae,le,ue;(ee=Z||(Z={}))[ee.connecting=0]="connecting",ee[ee.open=1]="open",ee[ee.closing=2]="closing",ee[ee.closed=3]="closed",(se=te||(te={})).closed="closed",se.errored="errored",se.joined="joined",se.joining="joining",se.leaving="leaving",(ne=re||(re={})).close="phx_close",ne.error="phx_error",ne.join="phx_join",ne.reply="phx_reply",ne.leave="phx_leave",ne.access_token="access_token",(ie||(ie={})).websocket="websocket",(ae=oe||(oe={})).Connecting="connecting",ae.Open="open",ae.Closing="closing",ae.Closed="closed";class he{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t("string"==typeof e?JSON.parse(e):{})}_binaryDecode(e){const t=new DataView(e),s=new TextDecoder;return this._decodeBroadcast(e,t,s)}_decodeBroadcast(e,t,s){const r=t.getUint8(1),n=t.getUint8(2);let i=this.HEADER_LENGTH+2;const o=s.decode(e.slice(i,i+r));i+=r;const a=s.decode(e.slice(i,i+n));i+=n;return{ref:null,topic:o,event:a,payload:JSON.parse(s.decode(e.slice(i,e.byteLength)))}}}class ce{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}(ue=le||(le={})).abstime="abstime",ue.bool="bool",ue.date="date",ue.daterange="daterange",ue.float4="float4",ue.float8="float8",ue.int2="int2",ue.int4="int4",ue.int4range="int4range",ue.int8="int8",ue.int8range="int8range",ue.json="json",ue.jsonb="jsonb",ue.money="money",ue.numeric="numeric",ue.oid="oid",ue.reltime="reltime",ue.text="text",ue.time="time",ue.timestamp="timestamp",ue.timestamptz="timestamptz",ue.timetz="timetz",ue.tsrange="tsrange",ue.tstzrange="tstzrange";const de=(e,t,s={})=>{var r;const n=null!==(r=s.skipTypes)&&void 0!==r?r:[];return Object.keys(t).reduce((s,r)=>(s[r]=fe(r,e,t,n),s),{})},fe=(e,t,s,r)=>{const n=t.find(t=>t.name===e),i=null==n?void 0:n.type,o=s[e];return i&&!r.includes(i)?pe(i,o):ge(o)},pe=(e,t)=>{if("_"===e.charAt(0)){const s=e.slice(1,e.length);return _e(t,s)}switch(e){case le.bool:return ye(t);case le.float4:case le.float8:case le.int2:case le.int4:case le.int8:case le.numeric:case le.oid:return ve(t);case le.json:case le.jsonb:return me(t);case le.timestamp:return be(t);case le.abstime:case le.date:case le.daterange:case le.int4range:case le.int8range:case le.money:case le.reltime:case le.text:case le.time:case le.timestamptz:case le.timetz:case le.tsrange:case le.tstzrange:default:return ge(t)}},ge=e=>e,ye=e=>{switch(e){case"t":return!0;case"f":return!1;default:return e}},ve=e=>{if("string"==typeof e){const t=parseFloat(e);if(!Number.isNaN(t))return t}return e},me=e=>{if("string"==typeof e)try{return JSON.parse(e)}catch(t){return console.log(`JSON parse error: ${t}`),e}return e},_e=(e,t)=>{if("string"!=typeof e)return e;const s=e.length-1,r=e[s];if("{"===e[0]&&"}"===r){let r;const i=e.slice(1,s);try{r=JSON.parse("["+i+"]")}catch(n){r=i?i.split(","):[]}return r.map(e=>pe(t,e))}return e},be=e=>"string"==typeof e?e.replace(" ","T"):e,we=e=>{let t=e;return t=t.replace(/^ws/i,"http"),t=t.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),t.replace(/\/+$/,"")};class ke{constructor(e,t,s={},r=1e4){this.channel=e,this.event=t,this.payload=s,this.timeout=r,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var s;return this._hasReceived(e)&&t(null===(s=this.receivedResp)||void 0===s?void 0:s.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);this.channel._on(this.refEvent,{},e=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=e,this._matchReceive(e)}),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(t=>t.status===e).forEach(e=>e.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var Se,Te,je,Ee,Pe,Oe,$e,Ae;(Te=Se||(Se={})).SYNC="sync",Te.JOIN="join",Te.LEAVE="leave";class Ce{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const s=(null==t?void 0:t.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(s.state,{},e=>{const{onJoin:t,onLeave:s,onSync:r}=this.caller;this.joinRef=this.channel._joinRef(),this.state=Ce.syncState(this.state,e,t,s),this.pendingDiffs.forEach(e=>{this.state=Ce.syncDiff(this.state,e,t,s)}),this.pendingDiffs=[],r()}),this.channel._on(s.diff,{},e=>{const{onJoin:t,onLeave:s,onSync:r}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(e):(this.state=Ce.syncDiff(this.state,e,t,s),r())}),this.onJoin((e,t,s)=>{this.channel._trigger("presence",{event:"join",key:e,currentPresences:t,newPresences:s})}),this.onLeave((e,t,s)=>{this.channel._trigger("presence",{event:"leave",key:e,currentPresences:t,leftPresences:s})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,s,r){const n=this.cloneDeep(e),i=this.transformState(t),o={},a={};return this.map(n,(e,t)=>{i[e]||(a[e]=t)}),this.map(i,(e,t)=>{const s=n[e];if(s){const r=t.map(e=>e.presence_ref),n=s.map(e=>e.presence_ref),i=t.filter(e=>n.indexOf(e.presence_ref)<0),l=s.filter(e=>r.indexOf(e.presence_ref)<0);i.length>0&&(o[e]=i),l.length>0&&(a[e]=l)}else o[e]=t}),this.syncDiff(n,{joins:o,leaves:a},s,r)}static syncDiff(e,t,s,r){const{joins:n,leaves:i}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return s||(s=()=>{}),r||(r=()=>{}),this.map(n,(t,r)=>{var n;const i=null!==(n=e[t])&&void 0!==n?n:[];if(e[t]=this.cloneDeep(r),i.length>0){const s=e[t].map(e=>e.presence_ref),r=i.filter(e=>s.indexOf(e.presence_ref)<0);e[t].unshift(...r)}s(t,i,r)}),this.map(i,(t,s)=>{let n=e[t];if(!n)return;const i=s.map(e=>e.presence_ref);n=n.filter(e=>i.indexOf(e.presence_ref)<0),e[t]=n,r(t,n,s),0===n.length&&delete e[t]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(s=>t(s,e[s]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,s)=>{const r=e[s];return t[s]="metas"in r?r.metas.map(e=>(e.presence_ref=e.phx_ref,delete e.phx_ref,delete e.phx_ref_prev,e)):r,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}(Ee=je||(je={})).ALL="*",Ee.INSERT="INSERT",Ee.UPDATE="UPDATE",Ee.DELETE="DELETE",(Oe=Pe||(Pe={})).BROADCAST="broadcast",Oe.PRESENCE="presence",Oe.POSTGRES_CHANGES="postgres_changes",Oe.SYSTEM="system",(Ae=$e||($e={})).SUBSCRIBED="SUBSCRIBED",Ae.TIMED_OUT="TIMED_OUT",Ae.CLOSED="CLOSED",Ae.CHANNEL_ERROR="CHANNEL_ERROR";class Ie{constructor(e,t={config:{}},s){this.topic=e,this.params=t,this.socket=s,this.bindings={},this.state=te.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new ke(this,re.join,this.params,this.timeout),this.rejoinTimer=new ce(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=te.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(e=>e.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=te.closed,this.socket._remove(this)}),this._onError(e=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,e),this.state=te.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=te.errored,this.rejoinTimer.scheduleTimeout())}),this._on(re.reply,{},(e,t)=>{this._trigger(this._replyEventName(t),e)}),this.presence=new Ce(this),this.broadcastEndpointURL=we(this.socket.endPoint)+"/api/broadcast",this.private=this.params.config.private||!1}subscribe(t,s=this.timeout){var r,n;if(this.socket.isConnected()||this.socket.connect(),this.state==te.closed){const{config:{broadcast:i,presence:o,private:a}}=this.params;this._onError(e=>null==t?void 0:t($e.CHANNEL_ERROR,e)),this._onClose(()=>null==t?void 0:t($e.CLOSED));const l={},u={broadcast:i,presence:o,postgres_changes:null!==(n=null===(r=this.bindings.postgres_changes)||void 0===r?void 0:r.map(e=>e.filter))&&void 0!==n?n:[],private:a};this.socket.accessTokenValue&&(l.access_token=this.socket.accessTokenValue),this.updateJoinPayload(Object.assign({config:u},l)),this.joinedOnce=!0,this._rejoin(s),this.joinPush.receive("ok",s=>e(this,[s],function*({postgres_changes:e}){var s;if(this.socket.setAuth(),void 0!==e){const r=this.bindings.postgres_changes,n=null!==(s=null==r?void 0:r.length)&&void 0!==s?s:0,i=[];for(let s=0;s<n;s++){const n=r[s],{filter:{event:o,schema:a,table:l,filter:u}}=n,h=e&&e[s];if(!h||h.event!==o||h.schema!==a||h.table!==l||h.filter!==u)return this.unsubscribe(),this.state=te.errored,void(null==t||t($e.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes")));i.push(Object.assign(Object.assign({},n),{id:h.id}))}return this.bindings.postgres_changes=i,void(t&&t($e.SUBSCRIBED))}null==t||t($e.SUBSCRIBED)})).receive("error",e=>{this.state=te.errored,null==t||t($e.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(e).join(", ")||"error")))}).receive("timeout",()=>{null==t||t($e.TIMED_OUT)})}return this}presenceState(){return this.presence.state}track(t){return e(this,arguments,function*(e,t={}){return yield this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)})}untrack(){return e(this,arguments,function*(e={}){return yield this.send({type:"presence",event:"untrack"},e)})}on(e,t,s){return this._on(e,t,s)}send(t){return e(this,arguments,function*(e,t={}){var s,r;if(this._canPush()||"broadcast"!==e.type)return new Promise(s=>{var r,n,i;const o=this._push(e.type,e,t.timeout||this.timeout);"broadcast"!==e.type||(null===(i=null===(n=null===(r=this.params)||void 0===r?void 0:r.config)||void 0===n?void 0:n.broadcast)||void 0===i?void 0:i.ack)||s("ok"),o.receive("ok",()=>s("ok")),o.receive("error",()=>s("error")),o.receive("timeout",()=>s("timed out"))});{const{event:i,payload:o}=e,a={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:i,payload:o,private:this.private}]})};try{const e=yield this._fetchWithTimeout(this.broadcastEndpointURL,a,null!==(s=t.timeout)&&void 0!==s?s:this.timeout);return yield null===(r=e.body)||void 0===r?void 0:r.cancel(),e.ok?"ok":"error"}catch(n){return"AbortError"===n.name?"timed out":"error"}}})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=te.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(re.close,"leave",this._joinRef())};this.joinPush.destroy();let s=null;return new Promise(r=>{s=new ke(this,re.leave,{},e),s.receive("ok",()=>{t(),r("ok")}).receive("timeout",()=>{t(),r("timed out")}).receive("error",()=>{r("error")}),s.send(),this._canPush()||s.trigger("ok",{})}).finally(()=>{null==s||s.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.rejoinTimer&&clearTimeout(this.rejoinTimer.timer),this.joinPush.destroy()}_fetchWithTimeout(t,s,r){return e(this,null,function*(){const e=new AbortController,n=setTimeout(()=>e.abort(),r),i=yield this.socket.fetch(t,Object.assign(Object.assign({},s),{signal:e.signal}));return clearTimeout(n),i})}_push(e,t,s=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let r=new ke(this,e,t,s);return this._canPush()?r.send():(r.startTimeout(),this.pushBuffer.push(r)),r}_onMessage(e,t,s){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,s){var r,n;const i=e.toLocaleLowerCase(),{close:o,error:a,leave:l,join:u}=re;if(s&&[o,a,l,u].indexOf(i)>=0&&s!==this._joinRef())return;let h=this._onMessage(i,t,s);if(t&&!h)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(i)?null===(r=this.bindings.postgres_changes)||void 0===r||r.filter(e=>{var t,s,r;return"*"===(null===(t=e.filter)||void 0===t?void 0:t.event)||(null===(r=null===(s=e.filter)||void 0===s?void 0:s.event)||void 0===r?void 0:r.toLocaleLowerCase())===i}).map(e=>e.callback(h,s)):null===(n=this.bindings[i])||void 0===n||n.filter(e=>{var s,r,n,o,a,l;if(["broadcast","presence","postgres_changes"].includes(i)){if("id"in e){const i=e.id,o=null===(s=e.filter)||void 0===s?void 0:s.event;return i&&(null===(r=t.ids)||void 0===r?void 0:r.includes(i))&&("*"===o||(null==o?void 0:o.toLocaleLowerCase())===(null===(n=t.data)||void 0===n?void 0:n.type.toLocaleLowerCase()))}{const s=null===(a=null===(o=null==e?void 0:e.filter)||void 0===o?void 0:o.event)||void 0===a?void 0:a.toLocaleLowerCase();return"*"===s||s===(null===(l=null==t?void 0:t.event)||void 0===l?void 0:l.toLocaleLowerCase())}}return e.type.toLocaleLowerCase()===i}).map(e=>{if("object"==typeof h&&"ids"in h){const e=h.data,{schema:t,table:s,commit_timestamp:r,type:n,errors:i}=e,o={schema:t,table:s,commit_timestamp:r,eventType:n,new:{},old:{},errors:i};h=Object.assign(Object.assign({},o),this._getPayloadRecords(e))}e.callback(h,s)})}_isClosed(){return this.state===te.closed}_isJoined(){return this.state===te.joined}_isJoining(){return this.state===te.joining}_isLeaving(){return this.state===te.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,s){const r=e.toLocaleLowerCase(),n={type:r,filter:t,callback:s};return this.bindings[r]?this.bindings[r].push(n):this.bindings[r]=[n],this}_off(e,t){const s=e.toLocaleLowerCase();return this.bindings[s]=this.bindings[s].filter(e=>{var r;return!((null===(r=e.type)||void 0===r?void 0:r.toLocaleLowerCase())===s&&Ie.isEqual(e.filter,t))}),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const s in e)if(e[s]!==t[s])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(re.close,{},e)}_onError(e){this._on(re.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=te.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return"INSERT"!==e.type&&"UPDATE"!==e.type||(t.new=de(e.columns,e.record)),"UPDATE"!==e.type&&"DELETE"!==e.type||(t.old=de(e.columns,e.old_record)),t}}const Re=()=>{};class xe{constructor(t,s){var r;this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=1e4,this.heartbeatIntervalMs=25e3,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=Re,this.ref=0,this.logger=Re,this.conn=null,this.sendBuffer=[],this.serializer=new he,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._resolveFetch=t=>{let s;return s=t||("undefined"==typeof fetch?(...t)=>n(()=>e(this,null,function*(){const{default:e}=yield Promise.resolve().then(()=>j);return{default:e}}),void 0).then(({default:e})=>e(...t)):fetch),(...e)=>s(...e)},this.endPoint=`${t}/${ie.websocket}`,this.httpEndpoint=we(t),(null==s?void 0:s.transport)?this.transport=s.transport:this.transport=null,(null==s?void 0:s.params)&&(this.params=s.params),(null==s?void 0:s.timeout)&&(this.timeout=s.timeout),(null==s?void 0:s.logger)&&(this.logger=s.logger),((null==s?void 0:s.logLevel)||(null==s?void 0:s.log_level))&&(this.logLevel=s.logLevel||s.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),(null==s?void 0:s.heartbeatIntervalMs)&&(this.heartbeatIntervalMs=s.heartbeatIntervalMs);const i=null===(r=null==s?void 0:s.params)||void 0===r?void 0:r.apikey;if(i&&(this.accessTokenValue=i,this.apiKey=i),this.reconnectAfterMs=(null==s?void 0:s.reconnectAfterMs)?s.reconnectAfterMs:e=>[1e3,2e3,5e3,1e4][e-1]||1e4,this.encode=(null==s?void 0:s.encode)?s.encode:(e,t)=>t(JSON.stringify(e)),this.decode=(null==s?void 0:s.decode)?s.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new ce(()=>e(this,null,function*(){this.disconnect(),this.connect()}),this.reconnectAfterMs),this.fetch=this._resolveFetch(null==s?void 0:s.fetch),null==s?void 0:s.worker){if("undefined"!=typeof window&&!window.Worker)throw new Error("Web Worker is not supported");this.worker=(null==s?void 0:s.worker)||!1,this.workerUrl=null==s?void 0:s.workerUrl}this.accessToken=(null==s?void 0:s.accessToken)||null}connect(){if(!this.conn){if(this.transport||(this.transport=X),!this.transport)throw new Error("No transport provided");this.conn=new this.transport(this.endpointURL()),this.setupConnection()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:"1.0.0"}))}disconnect(e,t){this.conn&&(this.conn.onclose=function(){},e?this.conn.close(e,null!=t?t:""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset(),this.channels.forEach(e=>e.teardown()))}getChannels(){return this.channels}removeChannel(t){return e(this,null,function*(){const e=yield t.unsubscribe();return 0===this.channels.length&&this.disconnect(),e})}removeAllChannels(){return e(this,null,function*(){const e=yield Promise.all(this.channels.map(e=>e.unsubscribe()));return this.channels=[],this.disconnect(),e})}log(e,t,s){this.logger(e,t,s)}connectionState(){switch(this.conn&&this.conn.readyState){case Z.connecting:return oe.Connecting;case Z.open:return oe.Open;case Z.closing:return oe.Closing;default:return oe.Closed}}isConnected(){return this.connectionState()===oe.Open}channel(e,t={config:{}}){const s=`realtime:${e}`,r=this.getChannels().find(e=>e.topic===s);if(r)return r;{const s=new Ie(`realtime:${e}`,t,this);return this.channels.push(s),s}}push(e){const{topic:t,event:s,payload:r,ref:n}=e,i=()=>{this.encode(e,e=>{var t;null===(t=this.conn)||void 0===t||t.send(e)})};this.log("push",`${t} ${s} (${n})`,r),this.isConnected()?i():this.sendBuffer.push(i)}setAuth(t=null){return e(this,null,function*(){let e=t||this.accessToken&&(yield this.accessToken())||this.accessTokenValue;this.accessTokenValue!=e&&(this.accessTokenValue=e,this.channels.forEach(t=>{const s={access_token:e,version:"realtime-js/2.11.15"};e&&t.updateJoinPayload(s),t.joinedOnce&&t._isJoined()&&t._push(re.access_token,{access_token:e})}))})}sendHeartbeat(){return e(this,null,function*(){var e;if(this.isConnected()){if(this.pendingHeartbeatRef)return this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),this.heartbeatCallback("timeout"),void(null===(e=this.conn)||void 0===e||e.close(1e3,"hearbeat timeout"));this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.heartbeatCallback("sent"),yield this.setAuth()}else this.heartbeatCallback("disconnected")})}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(t=>t.topic===e&&(t._isJoined()||t._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t.topic!==e.topic)}setupConnection(){this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_onConnMessage(e){this.decode(e.data,e=>{let{topic:t,event:s,payload:r,ref:n}=e;"phoenix"===t&&"phx_reply"===s&&this.heartbeatCallback("ok"==e.payload.status?"ok":"error"),n&&n===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null),this.log("receive",`${r.status||""} ${t} ${s} ${n&&"("+n+")"||""}`,r),Array.from(this.channels).filter(e=>e._isMember(t)).forEach(e=>e._trigger(s,r,n)),this.stateChangeCallbacks.message.forEach(t=>t(e))})}_onConnOpen(){this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this.reconnectTimer.reset(),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this.stateChangeCallbacks.open.forEach(e=>e())}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=e=>{this.log("worker","worker error",e.message),this.workerRef.terminate()},this.workerRef.onmessage=e=>{"keepAlive"===e.data.event&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(e){this.log("transport","close",e),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(t=>t(e))}_onConnError(e){this.log("transport",`${e}`),this._triggerChanError(),this.stateChangeCallbacks.error.forEach(t=>t(e))}_triggerChanError(){this.channels.forEach(e=>e._trigger(re.error))}_appendParams(e,t){if(0===Object.keys(t).length)return e;const s=e.match(/\?/)?"&":"?";return`${e}${s}${new URLSearchParams(t)}`}_workerObjectUrl(e){let t;if(e)t=e;else{const e=new Blob(['\n  addEventListener("message", (e) => {\n    if (e.data.event === "start") {\n      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);\n    }\n  });'],{type:"application/javascript"});t=URL.createObjectURL(e)}return t}}class Ue extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function Le(e){return"object"==typeof e&&null!==e&&"__isStorageError"in e}class De extends Ue{constructor(e,t){super(e),this.name="StorageApiError",this.status=t}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class Ne extends Ue{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}var qe=function(e,t,s,r){return new(s||(s=Promise))(function(n,i){function o(e){try{l(r.next(e))}catch(t){i(t)}}function a(e){try{l(r.throw(e))}catch(t){i(t)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s(function(e){e(t)})).then(o,a)}l((r=r.apply(e,t||[])).next())})};const Be=t=>{let s;return s=t||("undefined"==typeof fetch?(...t)=>n(()=>e(null,null,function*(){const{default:e}=yield Promise.resolve().then(()=>j);return{default:e}}),void 0).then(({default:e})=>e(...t)):fetch),(...e)=>s(...e)},Me=e=>{if(Array.isArray(e))return e.map(e=>Me(e));if("function"==typeof e||e!==Object(e))return e;const t={};return Object.entries(e).forEach(([e,s])=>{const r=e.replace(/([-_][a-z])/gi,e=>e.toUpperCase().replace(/[-_]/g,""));t[r]=Me(s)}),t};var Fe=function(e,t,s,r){return new(s||(s=Promise))(function(n,i){function o(e){try{l(r.next(e))}catch(t){i(t)}}function a(e){try{l(r.throw(e))}catch(t){i(t)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s(function(e){e(t)})).then(o,a)}l((r=r.apply(e,t||[])).next())})};const Ke=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),ze=(e,t,s)=>Fe(void 0,void 0,void 0,function*(){const r=yield qe(void 0,void 0,void 0,function*(){return"undefined"==typeof Response?(yield n(()=>Promise.resolve().then(()=>j),void 0)).Response:Response});e instanceof r&&!(null==s?void 0:s.noResolveJson)?e.json().then(s=>{t(new De(Ke(s),e.status||500))}).catch(e=>{t(new Ne(Ke(e),e))}):t(new Ne(Ke(e),e))});function We(e,t,s,r,n,i){return Fe(this,void 0,void 0,function*(){return new Promise((o,a)=>{e(s,((e,t,s,r)=>{const n={method:e,headers:(null==t?void 0:t.headers)||{}};return"GET"===e?n:(n.headers=Object.assign({"Content-Type":"application/json"},null==t?void 0:t.headers),r&&(n.body=JSON.stringify(r)),Object.assign(Object.assign({},n),s))})(t,r,n,i)).then(e=>{if(!e.ok)throw e;return(null==r?void 0:r.noResolveJson)?e:e.json()}).then(e=>o(e)).catch(e=>ze(e,a,r))})})}function Je(e,t,s,r){return Fe(this,void 0,void 0,function*(){return We(e,"GET",t,s,r)})}function He(e,t,s,r,n){return Fe(this,void 0,void 0,function*(){return We(e,"POST",t,r,n,s)})}function Ge(e,t,s,r,n){return Fe(this,void 0,void 0,function*(){return We(e,"DELETE",t,r,n,s)})}var Ve=function(e,t,s,r){return new(s||(s=Promise))(function(n,i){function o(e){try{l(r.next(e))}catch(t){i(t)}}function a(e){try{l(r.throw(e))}catch(t){i(t)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s(function(e){e(t)})).then(o,a)}l((r=r.apply(e,t||[])).next())})};const Ye={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},Qe={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class Xe{constructor(e,t={},s,r){this.url=e,this.headers=t,this.bucketId=s,this.fetch=Be(r)}uploadOrUpdate(e,t,s,r){return Ve(this,void 0,void 0,function*(){try{let n;const i=Object.assign(Object.assign({},Qe),r);let o=Object.assign(Object.assign({},this.headers),"POST"===e&&{"x-upsert":String(i.upsert)});const a=i.metadata;"undefined"!=typeof Blob&&s instanceof Blob?(n=new FormData,n.append("cacheControl",i.cacheControl),a&&n.append("metadata",this.encodeMetadata(a)),n.append("",s)):"undefined"!=typeof FormData&&s instanceof FormData?(n=s,n.append("cacheControl",i.cacheControl),a&&n.append("metadata",this.encodeMetadata(a))):(n=s,o["cache-control"]=`max-age=${i.cacheControl}`,o["content-type"]=i.contentType,a&&(o["x-metadata"]=this.toBase64(this.encodeMetadata(a)))),(null==r?void 0:r.headers)&&(o=Object.assign(Object.assign({},o),r.headers));const l=this._removeEmptyFolders(t),u=this._getFinalPath(l),h=yield this.fetch(`${this.url}/object/${u}`,Object.assign({method:e,body:n,headers:o},(null==i?void 0:i.duplex)?{duplex:i.duplex}:{})),c=yield h.json();if(h.ok)return{data:{path:l,id:c.Id,fullPath:c.Key},error:null};return{data:null,error:c}}catch(n){if(Le(n))return{data:null,error:n};throw n}})}upload(e,t,s){return Ve(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,s)})}uploadToSignedUrl(e,t,s,r){return Ve(this,void 0,void 0,function*(){const n=this._removeEmptyFolders(e),i=this._getFinalPath(n),o=new URL(this.url+`/object/upload/sign/${i}`);o.searchParams.set("token",t);try{let e;const t=Object.assign({upsert:Qe.upsert},r),i=Object.assign(Object.assign({},this.headers),{"x-upsert":String(t.upsert)});"undefined"!=typeof Blob&&s instanceof Blob?(e=new FormData,e.append("cacheControl",t.cacheControl),e.append("",s)):"undefined"!=typeof FormData&&s instanceof FormData?(e=s,e.append("cacheControl",t.cacheControl)):(e=s,i["cache-control"]=`max-age=${t.cacheControl}`,i["content-type"]=t.contentType);const a=yield this.fetch(o.toString(),{method:"PUT",body:e,headers:i}),l=yield a.json();if(a.ok)return{data:{path:n,fullPath:l.Key},error:null};return{data:null,error:l}}catch(a){if(Le(a))return{data:null,error:a};throw a}})}createSignedUploadUrl(e,t){return Ve(this,void 0,void 0,function*(){try{let s=this._getFinalPath(e);const r=Object.assign({},this.headers);(null==t?void 0:t.upsert)&&(r["x-upsert"]="true");const n=yield He(this.fetch,`${this.url}/object/upload/sign/${s}`,{},{headers:r}),i=new URL(this.url+n.url),o=i.searchParams.get("token");if(!o)throw new Ue("No token returned by API");return{data:{signedUrl:i.toString(),path:e,token:o},error:null}}catch(s){if(Le(s))return{data:null,error:s};throw s}})}update(e,t,s){return Ve(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,s)})}move(e,t,s){return Ve(this,void 0,void 0,function*(){try{return{data:yield He(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:null==s?void 0:s.destinationBucket},{headers:this.headers}),error:null}}catch(r){if(Le(r))return{data:null,error:r};throw r}})}copy(e,t,s){return Ve(this,void 0,void 0,function*(){try{return{data:{path:(yield He(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:null==s?void 0:s.destinationBucket},{headers:this.headers})).Key},error:null}}catch(r){if(Le(r))return{data:null,error:r};throw r}})}createSignedUrl(e,t,s){return Ve(this,void 0,void 0,function*(){try{let r=this._getFinalPath(e),n=yield He(this.fetch,`${this.url}/object/sign/${r}`,Object.assign({expiresIn:t},(null==s?void 0:s.transform)?{transform:s.transform}:{}),{headers:this.headers});const i=(null==s?void 0:s.download)?`&download=${!0===s.download?"":s.download}`:"";return n={signedUrl:encodeURI(`${this.url}${n.signedURL}${i}`)},{data:n,error:null}}catch(r){if(Le(r))return{data:null,error:r};throw r}})}createSignedUrls(e,t,s){return Ve(this,void 0,void 0,function*(){try{const r=yield He(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),n=(null==s?void 0:s.download)?`&download=${!0===s.download?"":s.download}`:"";return{data:r.map(e=>Object.assign(Object.assign({},e),{signedUrl:e.signedURL?encodeURI(`${this.url}${e.signedURL}${n}`):null})),error:null}}catch(r){if(Le(r))return{data:null,error:r};throw r}})}download(e,t){return Ve(this,void 0,void 0,function*(){const s=void 0!==(null==t?void 0:t.transform)?"render/image/authenticated":"object",r=this.transformOptsToQueryString((null==t?void 0:t.transform)||{}),n=r?`?${r}`:"";try{const t=this._getFinalPath(e),r=yield Je(this.fetch,`${this.url}/${s}/${t}${n}`,{headers:this.headers,noResolveJson:!0});return{data:yield r.blob(),error:null}}catch(i){if(Le(i))return{data:null,error:i};throw i}})}info(e){return Ve(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{const e=yield Je(this.fetch,`${this.url}/object/info/${t}`,{headers:this.headers});return{data:Me(e),error:null}}catch(s){if(Le(s))return{data:null,error:s};throw s}})}exists(e){return Ve(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{return yield function(e,t,s,r){return Fe(this,void 0,void 0,function*(){return We(e,"HEAD",t,Object.assign(Object.assign({},s),{noResolveJson:!0}),r)})}(this.fetch,`${this.url}/object/${t}`,{headers:this.headers}),{data:!0,error:null}}catch(s){if(Le(s)&&s instanceof Ne){const e=s.originalError;if([400,404].includes(null==e?void 0:e.status))return{data:!1,error:s}}throw s}})}getPublicUrl(e,t){const s=this._getFinalPath(e),r=[],n=(null==t?void 0:t.download)?`download=${!0===t.download?"":t.download}`:"";""!==n&&r.push(n);const i=void 0!==(null==t?void 0:t.transform)?"render/image":"object",o=this.transformOptsToQueryString((null==t?void 0:t.transform)||{});""!==o&&r.push(o);let a=r.join("&");return""!==a&&(a=`?${a}`),{data:{publicUrl:encodeURI(`${this.url}/${i}/public/${s}${a}`)}}}remove(e){return Ve(this,void 0,void 0,function*(){try{return{data:yield Ge(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(Le(t))return{data:null,error:t};throw t}})}list(e,t,s){return Ve(this,void 0,void 0,function*(){try{const r=Object.assign(Object.assign(Object.assign({},Ye),t),{prefix:e||""});return{data:yield He(this.fetch,`${this.url}/object/list/${this.bucketId}`,r,{headers:this.headers},s),error:null}}catch(r){if(Le(r))return{data:null,error:r};throw r}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return"undefined"!=typeof Buffer?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}const Ze={"X-Client-Info":"storage-js/2.7.1"};var et=function(e,t,s,r){return new(s||(s=Promise))(function(n,i){function o(e){try{l(r.next(e))}catch(t){i(t)}}function a(e){try{l(r.throw(e))}catch(t){i(t)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s(function(e){e(t)})).then(o,a)}l((r=r.apply(e,t||[])).next())})};class tt{constructor(e,t={},s){this.url=e,this.headers=Object.assign(Object.assign({},Ze),t),this.fetch=Be(s)}listBuckets(){return et(this,void 0,void 0,function*(){try{return{data:yield Je(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(Le(e))return{data:null,error:e};throw e}})}getBucket(e){return et(this,void 0,void 0,function*(){try{return{data:yield Je(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(Le(t))return{data:null,error:t};throw t}})}createBucket(e,t={public:!1}){return et(this,void 0,void 0,function*(){try{return{data:yield He(this.fetch,`${this.url}/bucket`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(s){if(Le(s))return{data:null,error:s};throw s}})}updateBucket(e,t){return et(this,void 0,void 0,function*(){try{const s=yield function(e,t,s,r,n){return Fe(this,void 0,void 0,function*(){return We(e,"PUT",t,r,n,s)})}(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers});return{data:s,error:null}}catch(s){if(Le(s))return{data:null,error:s};throw s}})}emptyBucket(e){return et(this,void 0,void 0,function*(){try{return{data:yield He(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(Le(t))return{data:null,error:t};throw t}})}deleteBucket(e){return et(this,void 0,void 0,function*(){try{return{data:yield Ge(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(Le(t))return{data:null,error:t};throw t}})}}class st extends tt{constructor(e,t={},s){super(e,t,s)}from(e){return new Xe(this.url,this.headers,e,this.fetch)}}let rt="";rt="undefined"!=typeof Deno?"deno":"undefined"!=typeof document?"web":"undefined"!=typeof navigator&&"ReactNative"===navigator.product?"react-native":"node";const nt={headers:{"X-Client-Info":`supabase-js-${rt}/2.51.0`}},it={schema:"public"},ot={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},at={};var lt=function(e,t,s,r){return new(s||(s=Promise))(function(n,i){function o(e){try{l(r.next(e))}catch(t){i(t)}}function a(e){try{l(r.throw(e))}catch(t){i(t)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s(function(e){e(t)})).then(o,a)}l((r=r.apply(e,t||[])).next())})};const ut=(e,t,s)=>{const r=(e=>{let t;return t=e||("undefined"==typeof fetch?w:fetch),(...e)=>t(...e)})(s),n="undefined"==typeof Headers?k:Headers;return(s,i)=>lt(void 0,void 0,void 0,function*(){var o;const a=null!==(o=yield t())&&void 0!==o?o:e;let l=new n(null==i?void 0:i.headers);return l.has("apikey")||l.set("apikey",e),l.has("Authorization")||l.set("Authorization",`Bearer ${a}`),r(s,Object.assign(Object.assign({},i),{headers:l}))})};var ht=function(e,t,s,r){return new(s||(s=Promise))(function(n,i){function o(e){try{l(r.next(e))}catch(t){i(t)}}function a(e){try{l(r.throw(e))}catch(t){i(t)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s(function(e){e(t)})).then(o,a)}l((r=r.apply(e,t||[])).next())})};const ct="2.71.0",dt=3e4,ft=9e4,pt={"X-Client-Info":`gotrue-js/${ct}`},gt="X-Supabase-Api-Version",yt={timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"},vt=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i;class mt extends Error{constructor(e,t,s){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=s}}function _t(e){return"object"==typeof e&&null!==e&&"__isAuthError"in e}class bt extends mt{constructor(e,t,s){super(e,t,s),this.name="AuthApiError",this.status=t,this.code=s}}class wt extends mt{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class kt extends mt{constructor(e,t,s,r){super(e,s,r),this.name=t,this.status=s}}class St extends kt{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}class Tt extends kt{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class jt extends kt{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class Et extends kt{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Pt extends kt{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Ot extends kt{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function $t(e){return _t(e)&&"AuthRetryableFetchError"===e.name}class At extends kt{constructor(e,t,s){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=s}}class Ct extends kt{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const It="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),Rt=" \t\n\r=".split(""),xt=(()=>{const e=new Array(128);for(let t=0;t<e.length;t+=1)e[t]=-1;for(let t=0;t<Rt.length;t+=1)e[Rt[t].charCodeAt(0)]=-2;for(let t=0;t<It.length;t+=1)e[It[t].charCodeAt(0)]=t;return e})();function Ut(e,t,s){if(null!==e)for(t.queue=t.queue<<8|e,t.queuedBits+=8;t.queuedBits>=6;){const e=t.queue>>t.queuedBits-6&63;s(It[e]),t.queuedBits-=6}else if(t.queuedBits>0)for(t.queue=t.queue<<6-t.queuedBits,t.queuedBits=6;t.queuedBits>=6;){const e=t.queue>>t.queuedBits-6&63;s(It[e]),t.queuedBits-=6}}function Lt(e,t,s){const r=xt[e];if(!(r>-1)){if(-2===r)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(e)}"`)}for(t.queue=t.queue<<6|r,t.queuedBits+=6;t.queuedBits>=8;)s(t.queue>>t.queuedBits-8&255),t.queuedBits-=8}function Dt(e){const t=[],s=e=>{t.push(String.fromCodePoint(e))},r={utf8seq:0,codepoint:0},n={queue:0,queuedBits:0},i=e=>{!function(e,t,s){if(0===t.utf8seq){if(e<=127)return void s(e);for(let s=1;s<6;s+=1)if(!(e>>7-s&1)){t.utf8seq=s;break}if(2===t.utf8seq)t.codepoint=31&e;else if(3===t.utf8seq)t.codepoint=15&e;else{if(4!==t.utf8seq)throw new Error("Invalid UTF-8 sequence");t.codepoint=7&e}t.utf8seq-=1}else if(t.utf8seq>0){if(e<=127)throw new Error("Invalid UTF-8 sequence");t.codepoint=t.codepoint<<6|63&e,t.utf8seq-=1,0===t.utf8seq&&s(t.codepoint)}}(e,r,s)};for(let o=0;o<e.length;o+=1)Lt(e.charCodeAt(o),n,i);return t.join("")}function Nt(e,t){if(!(e<=127)){if(e<=2047)return t(192|e>>6),void t(128|63&e);if(e<=65535)return t(224|e>>12),t(128|e>>6&63),void t(128|63&e);if(e<=1114111)return t(240|e>>18),t(128|e>>12&63),t(128|e>>6&63),void t(128|63&e);throw new Error(`Unrecognized Unicode codepoint: ${e.toString(16)}`)}t(e)}function qt(e){const t=[],s={queue:0,queuedBits:0},r=e=>{t.push(e)};for(let n=0;n<e.length;n+=1)Lt(e.charCodeAt(n),s,r);return new Uint8Array(t)}function Bt(e){const t=[];return function(e,t){for(let s=0;s<e.length;s+=1){let r=e.charCodeAt(s);if(r>55295&&r<=56319){const t=1024*(r-55296)&65535;r=65536+(e.charCodeAt(s+1)-56320&65535|t),s+=1}Nt(r,t)}}(e,e=>t.push(e)),new Uint8Array(t)}function Mt(e){const t=[],s={queue:0,queuedBits:0},r=e=>{t.push(e)};return e.forEach(e=>Ut(e,s,r)),Ut(null,s,r),t.join("")}const Ft=()=>"undefined"!=typeof window&&"undefined"!=typeof document,Kt={tested:!1,writable:!1},zt=()=>{if(!Ft())return!1;try{if("object"!=typeof globalThis.localStorage)return!1}catch(t){return!1}if(Kt.tested)return Kt.writable;const e=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(e,e),globalThis.localStorage.removeItem(e),Kt.tested=!0,Kt.writable=!0}catch(t){Kt.tested=!0,Kt.writable=!1}return Kt.writable};const Wt=t=>{let s;return s=t||("undefined"==typeof fetch?(...t)=>n(()=>e(null,null,function*(){const{default:e}=yield Promise.resolve().then(()=>j);return{default:e}}),void 0).then(({default:e})=>e(...t)):fetch),(...e)=>s(...e)},Jt=(t,s,r)=>e(null,null,function*(){yield t.setItem(s,JSON.stringify(r))}),Ht=(t,s)=>e(null,null,function*(){const e=yield t.getItem(s);if(!e)return null;try{return JSON.parse(e)}catch(r){return e}}),Gt=(t,s)=>e(null,null,function*(){yield t.removeItem(s)});class Vt{constructor(){this.promise=new Vt.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}function Yt(e){const t=e.split(".");if(3!==t.length)throw new Ct("Invalid JWT structure");for(let s=0;s<t.length;s++)if(!vt.test(t[s]))throw new Ct("JWT not in base64url format");return{header:JSON.parse(Dt(t[0])),payload:JSON.parse(Dt(t[1])),signature:qt(t[2]),raw:{header:t[0],payload:t[1]}}}function Qt(e){return("0"+e.toString(16)).substr(-2)}function Xt(t){return e(this,null,function*(){if(!("undefined"!=typeof crypto&&void 0!==crypto.subtle&&"undefined"!=typeof TextEncoder))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),t;const s=yield function(t){return e(this,null,function*(){const e=(new TextEncoder).encode(t),s=yield crypto.subtle.digest("SHA-256",e),r=new Uint8Array(s);return Array.from(r).map(e=>String.fromCharCode(e)).join("")})}(t);return btoa(s).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")})}function Zt(t,s,r=!1){return e(this,null,function*(){const e=function(){const e=new Uint32Array(56);if("undefined"==typeof crypto){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",t=e.length;let s="";for(let r=0;r<56;r++)s+=e.charAt(Math.floor(Math.random()*t));return s}return crypto.getRandomValues(e),Array.from(e,Qt).join("")}();let n=e;r&&(n+="/PASSWORD_RECOVERY"),yield Jt(t,`${s}-code-verifier`,n);const i=yield Xt(e);return[i,e===i?"plain":"s256"]})}Vt.promiseConstructor=Promise;const es=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;const ts=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function ss(e){if(!ts.test(e))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function rs(){return new Proxy({},{get:(e,t)=>{if("__isUserNotAvailableProxy"===t)return!0;if("symbol"==typeof t){const e=t.toString();if("Symbol(Symbol.toPrimitive)"===e||"Symbol(Symbol.toStringTag)"===e||"Symbol(util.inspect.custom)"===e)return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${t}" property of the session object is not supported. Please use getUser() instead.`)},set:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}const ns=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),is=[502,503,504];function os(t){return e(this,null,function*(){var e,s;if(!("object"==typeof(s=t)&&null!==s&&"status"in s&&"ok"in s&&"json"in s&&"function"==typeof s.json))throw new Ot(ns(t),0);if(is.includes(t.status))throw new Ot(ns(t),t.status);let r,n;try{r=yield t.json()}catch(o){throw new wt(ns(o),o)}const i=function(e){const t=e.headers.get(gt);if(!t)return null;if(!t.match(es))return null;try{return new Date(`${t}T00:00:00.0Z`)}catch(o){return null}}(t);if(i&&i.getTime()>=yt.timestamp&&"object"==typeof r&&r&&"string"==typeof r.code?n=r.code:"object"==typeof r&&r&&"string"==typeof r.error_code&&(n=r.error_code),n){if("weak_password"===n)throw new At(ns(r),t.status,(null===(e=r.weak_password)||void 0===e?void 0:e.reasons)||[]);if("session_not_found"===n)throw new St}else if("object"==typeof r&&r&&"object"==typeof r.weak_password&&r.weak_password&&Array.isArray(r.weak_password.reasons)&&r.weak_password.reasons.length&&r.weak_password.reasons.reduce((e,t)=>e&&"string"==typeof t,!0))throw new At(ns(r),t.status,r.weak_password.reasons);throw new bt(ns(r),t.status||500,n)})}function as(t,s,r,n){return e(this,null,function*(){var i;const o=Object.assign({},null==n?void 0:n.headers);o[gt]||(o[gt]=yt.name),(null==n?void 0:n.jwt)&&(o.Authorization=`Bearer ${n.jwt}`);const a=null!==(i=null==n?void 0:n.query)&&void 0!==i?i:{};(null==n?void 0:n.redirectTo)&&(a.redirect_to=n.redirectTo);const l=Object.keys(a).length?"?"+new URLSearchParams(a).toString():"",u=yield function(t,s,r,n,i,o){return e(this,null,function*(){const e=((e,t,s,r)=>{const n={method:e,headers:(null==t?void 0:t.headers)||{}};return"GET"===e?n:(n.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},null==t?void 0:t.headers),n.body=JSON.stringify(r),Object.assign(Object.assign({},n),s))})(s,n,i,o);let a;try{a=yield t(r,Object.assign({},e))}catch(l){throw console.error(l),new Ot(ns(l),0)}if(a.ok||(yield os(a)),null==n?void 0:n.noResolveJson)return a;try{return yield a.json()}catch(l){yield os(l)}})}(t,s,r+l,{headers:o,noResolveJson:null==n?void 0:n.noResolveJson},{},null==n?void 0:n.body);return(null==n?void 0:n.xform)?null==n?void 0:n.xform(u):{data:Object.assign({},u),error:null}})}function ls(e){var t;let s=null;var r;(function(e){return e.access_token&&e.refresh_token&&e.expires_in})(e)&&(s=Object.assign({},e),e.expires_at||(s.expires_at=(r=e.expires_in,Math.round(Date.now()/1e3)+r)));return{data:{session:s,user:null!==(t=e.user)&&void 0!==t?t:e},error:null}}function us(e){const t=ls(e);return!t.error&&e.weak_password&&"object"==typeof e.weak_password&&Array.isArray(e.weak_password.reasons)&&e.weak_password.reasons.length&&e.weak_password.message&&"string"==typeof e.weak_password.message&&e.weak_password.reasons.reduce((e,t)=>e&&"string"==typeof t,!0)&&(t.data.weak_password=e.weak_password),t}function hs(e){var t;return{data:{user:null!==(t=e.user)&&void 0!==t?t:e},error:null}}function cs(e){return{data:e,error:null}}function ds(e){const{action_link:t,email_otp:s,hashed_token:r,redirect_to:n,verification_type:i}=e,o=function(e,t){var s={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(s[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(r=Object.getOwnPropertySymbols(e);n<r.length;n++)t.indexOf(r[n])<0&&Object.prototype.propertyIsEnumerable.call(e,r[n])&&(s[r[n]]=e[r[n]])}return s}(e,["action_link","email_otp","hashed_token","redirect_to","verification_type"]);return{data:{properties:{action_link:t,email_otp:s,hashed_token:r,redirect_to:n,verification_type:i},user:Object.assign({},o)},error:null}}function fs(e){return e}const ps=["global","local","others"];class gs{constructor({url:e="",headers:t={},fetch:s}){this.url=e,this.headers=t,this.fetch=Wt(s),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}signOut(t){return e(this,arguments,function*(e,t=ps[0]){if(ps.indexOf(t)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${ps.join(", ")}`);try{return yield as(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(s){if(_t(s))return{data:null,error:s};throw s}})}inviteUserByEmail(t){return e(this,arguments,function*(e,t={}){try{return yield as(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:hs})}catch(s){if(_t(s))return{data:{user:null},error:s};throw s}})}generateLink(t){return e(this,null,function*(){try{const{options:e}=t,s=function(e,t){var s={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(s[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(r=Object.getOwnPropertySymbols(e);n<r.length;n++)t.indexOf(r[n])<0&&Object.prototype.propertyIsEnumerable.call(e,r[n])&&(s[r[n]]=e[r[n]])}return s}(t,["options"]),r=Object.assign(Object.assign({},s),e);return"newEmail"in s&&(r.new_email=null==s?void 0:s.newEmail,delete r.newEmail),yield as(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:r,headers:this.headers,xform:ds,redirectTo:null==e?void 0:e.redirectTo})}catch(e){if(_t(e))return{data:{properties:null,user:null},error:e};throw e}})}createUser(t){return e(this,null,function*(){try{return yield as(this.fetch,"POST",`${this.url}/admin/users`,{body:t,headers:this.headers,xform:hs})}catch(e){if(_t(e))return{data:{user:null},error:e};throw e}})}listUsers(t){return e(this,null,function*(){var e,s,r,n,i,o,a;try{const l={nextPage:null,lastPage:0,total:0},u=yield as(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:null!==(s=null===(e=null==t?void 0:t.page)||void 0===e?void 0:e.toString())&&void 0!==s?s:"",per_page:null!==(n=null===(r=null==t?void 0:t.perPage)||void 0===r?void 0:r.toString())&&void 0!==n?n:""},xform:fs});if(u.error)throw u.error;const h=yield u.json(),c=null!==(i=u.headers.get("x-total-count"))&&void 0!==i?i:0,d=null!==(a=null===(o=u.headers.get("link"))||void 0===o?void 0:o.split(","))&&void 0!==a?a:[];return d.length>0&&(d.forEach(e=>{const t=parseInt(e.split(";")[0].split("=")[1].substring(0,1)),s=JSON.parse(e.split(";")[1].split("=")[1]);l[`${s}Page`]=t}),l.total=parseInt(c)),{data:Object.assign(Object.assign({},h),l),error:null}}catch(l){if(_t(l))return{data:{users:[]},error:l};throw l}})}getUserById(t){return e(this,null,function*(){ss(t);try{return yield as(this.fetch,"GET",`${this.url}/admin/users/${t}`,{headers:this.headers,xform:hs})}catch(e){if(_t(e))return{data:{user:null},error:e};throw e}})}updateUserById(t,s){return e(this,null,function*(){ss(t);try{return yield as(this.fetch,"PUT",`${this.url}/admin/users/${t}`,{body:s,headers:this.headers,xform:hs})}catch(e){if(_t(e))return{data:{user:null},error:e};throw e}})}deleteUser(t,s=!1){return e(this,null,function*(){ss(t);try{return yield as(this.fetch,"DELETE",`${this.url}/admin/users/${t}`,{headers:this.headers,body:{should_soft_delete:s},xform:hs})}catch(e){if(_t(e))return{data:{user:null},error:e};throw e}})}_listFactors(t){return e(this,null,function*(){ss(t.userId);try{const{data:e,error:s}=yield as(this.fetch,"GET",`${this.url}/admin/users/${t.userId}/factors`,{headers:this.headers,xform:e=>({data:{factors:e},error:null})});return{data:e,error:s}}catch(e){if(_t(e))return{data:null,error:e};throw e}})}_deleteFactor(t){return e(this,null,function*(){ss(t.userId),ss(t.id);try{return{data:yield as(this.fetch,"DELETE",`${this.url}/admin/users/${t.userId}/factors/${t.id}`,{headers:this.headers}),error:null}}catch(e){if(_t(e))return{data:null,error:e};throw e}})}}function ys(e={}){return{getItem:t=>e[t]||null,setItem:(t,s)=>{e[t]=s},removeItem:t=>{delete e[t]}}}const vs=!!(globalThis&&zt()&&globalThis.localStorage&&"true"===globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug"));class ms extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class _s extends ms{}function bs(t,s,r){return e(this,null,function*(){vs&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",t,s);const n=new globalThis.AbortController;return s>0&&setTimeout(()=>{n.abort(),vs&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",t)},s),yield Promise.resolve().then(()=>globalThis.navigator.locks.request(t,0===s?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:n.signal},n=>e(null,null,function*(){if(!n){if(0===s)throw vs&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",t),new _s(`Acquiring an exclusive Navigator LockManager lock "${t}" immediately failed`);if(vs)try{const e=yield globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(e,null,"  "))}catch(e){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",e)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),yield r()}vs&&console.log("@supabase/gotrue-js: navigatorLock: acquired",t,n.name);try{return yield r()}finally{vs&&console.log("@supabase/gotrue-js: navigatorLock: released",t,n.name)}})))})}!function(){if("object"!=typeof globalThis)try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch(e){"undefined"!=typeof self&&(self.globalThis=self)}}();const ws={url:"http://localhost:9999",storageKey:"supabase.auth.token",autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:pt,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};function ks(t,s,r){return e(this,null,function*(){return yield r()})}const Ss={};class Ts{constructor(t){var s,r;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=Ts.nextInstanceID,Ts.nextInstanceID+=1,this.instanceID>0&&Ft()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const n=Object.assign(Object.assign({},ws),t);if(this.logDebugMessages=!!n.debug,"function"==typeof n.debug&&(this.logger=n.debug),this.persistSession=n.persistSession,this.storageKey=n.storageKey,this.autoRefreshToken=n.autoRefreshToken,this.admin=new gs({url:n.url,headers:n.headers,fetch:n.fetch}),this.url=n.url,this.headers=n.headers,this.fetch=Wt(n.fetch),this.lock=n.lock||ks,this.detectSessionInUrl=n.detectSessionInUrl,this.flowType=n.flowType,this.hasCustomAuthorizationHeader=n.hasCustomAuthorizationHeader,n.lock?this.lock=n.lock:Ft()&&(null===(s=null===globalThis||void 0===globalThis?void 0:globalThis.navigator)||void 0===s?void 0:s.locks)?this.lock=bs:this.lock=ks,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?(n.storage?this.storage=n.storage:zt()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=ys(this.memoryStorage)),n.userStorage&&(this.userStorage=n.userStorage)):(this.memoryStorage={},this.storage=ys(this.memoryStorage)),Ft()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(i){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",i)}null===(r=this.broadcastChannel)||void 0===r||r.addEventListener("message",t=>e(this,null,function*(){this._debug("received broadcast notification from other tab or client",t),yield this._notifyAllSubscribers(t.data.event,t.data.session,!1)}))}this.initialize()}get jwks(){var e,t;return null!==(t=null===(e=Ss[this.storageKey])||void 0===e?void 0:e.jwks)&&void 0!==t?t:{keys:[]}}set jwks(e){Ss[this.storageKey]=Object.assign(Object.assign({},Ss[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,t;return null!==(t=null===(e=Ss[this.storageKey])||void 0===e?void 0:e.cachedAt)&&void 0!==t?t:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){Ss[this.storageKey]=Object.assign(Object.assign({},Ss[this.storageKey]),{cachedAt:e})}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${ct}) ${(new Date).toISOString()}`,...e),this}initialize(){return e(this,null,function*(){return this.initializePromise||(this.initializePromise=(()=>e(this,null,function*(){return yield this._acquireLock(-1,()=>e(this,null,function*(){return yield this._initialize()}))}))()),yield this.initializePromise})}_initialize(){return e(this,null,function*(){var t;try{const s=function(e){const t={},s=new URL(e);if(s.hash&&"#"===s.hash[0])try{new URLSearchParams(s.hash.substring(1)).forEach((e,s)=>{t[s]=e})}catch(r){}return s.searchParams.forEach((e,s)=>{t[s]=e}),t}(window.location.href);let r="none";if(this._isImplicitGrantCallback(s)?r="implicit":(yield this._isPKCECallback(s))&&(r="pkce"),Ft()&&this.detectSessionInUrl&&"none"!==r){const{data:n,error:i}=yield this._getSessionFromURL(s,r);if(i){if(this._debug("#_initialize()","error detecting session from URL",i),function(e){return _t(e)&&"AuthImplicitGrantRedirectError"===e.name}(i)){const e=null===(t=i.details)||void 0===t?void 0:t.code;if("identity_already_exists"===e||"identity_not_found"===e||"single_identity_not_deletable"===e)return{error:i}}return yield this._removeSession(),{error:i}}const{session:o,redirectType:a}=n;return this._debug("#_initialize()","detected session in URL",o,"redirect type",a),yield this._saveSession(o),setTimeout(()=>e(this,null,function*(){"recovery"===a?yield this._notifyAllSubscribers("PASSWORD_RECOVERY",o):yield this._notifyAllSubscribers("SIGNED_IN",o)}),0),{error:null}}return yield this._recoverAndRefresh(),{error:null}}catch(s){return _t(s)?{error:s}:{error:new wt("Unexpected error during initialization",s)}}finally{yield this._handleVisibilityChange(),this._debug("#_initialize()","end")}})}signInAnonymously(t){return e(this,null,function*(){var e,s,r;try{const n=yield as(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:null!==(s=null===(e=null==t?void 0:t.options)||void 0===e?void 0:e.data)&&void 0!==s?s:{},gotrue_meta_security:{captcha_token:null===(r=null==t?void 0:t.options)||void 0===r?void 0:r.captchaToken}},xform:ls}),{data:i,error:o}=n;if(o||!i)return{data:{user:null,session:null},error:o};const a=i.session,l=i.user;return i.session&&(yield this._saveSession(i.session),yield this._notifyAllSubscribers("SIGNED_IN",a)),{data:{user:l,session:a},error:null}}catch(n){if(_t(n))return{data:{user:null,session:null},error:n};throw n}})}signUp(t){return e(this,null,function*(){var e,s,r;try{let n;if("email"in t){const{email:s,password:r,options:i}=t;let o=null,a=null;"pkce"===this.flowType&&([o,a]=yield Zt(this.storage,this.storageKey)),n=yield as(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:null==i?void 0:i.emailRedirectTo,body:{email:s,password:r,data:null!==(e=null==i?void 0:i.data)&&void 0!==e?e:{},gotrue_meta_security:{captcha_token:null==i?void 0:i.captchaToken},code_challenge:o,code_challenge_method:a},xform:ls})}else{if(!("phone"in t))throw new jt("You must provide either an email or phone number and a password");{const{phone:e,password:i,options:o}=t;n=yield as(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:e,password:i,data:null!==(s=null==o?void 0:o.data)&&void 0!==s?s:{},channel:null!==(r=null==o?void 0:o.channel)&&void 0!==r?r:"sms",gotrue_meta_security:{captcha_token:null==o?void 0:o.captchaToken}},xform:ls})}}const{data:i,error:o}=n;if(o||!i)return{data:{user:null,session:null},error:o};const a=i.session,l=i.user;return i.session&&(yield this._saveSession(i.session),yield this._notifyAllSubscribers("SIGNED_IN",a)),{data:{user:l,session:a},error:null}}catch(n){if(_t(n))return{data:{user:null,session:null},error:n};throw n}})}signInWithPassword(t){return e(this,null,function*(){try{let e;if("email"in t){const{email:s,password:r,options:n}=t;e=yield as(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:s,password:r,gotrue_meta_security:{captcha_token:null==n?void 0:n.captchaToken}},xform:us})}else{if(!("phone"in t))throw new jt("You must provide either an email or phone number and a password");{const{phone:s,password:r,options:n}=t;e=yield as(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:s,password:r,gotrue_meta_security:{captcha_token:null==n?void 0:n.captchaToken}},xform:us})}}const{data:s,error:r}=e;return r?{data:{user:null,session:null},error:r}:s&&s.session&&s.user?(s.session&&(yield this._saveSession(s.session),yield this._notifyAllSubscribers("SIGNED_IN",s.session)),{data:Object.assign({user:s.user,session:s.session},s.weak_password?{weakPassword:s.weak_password}:null),error:r}):{data:{user:null,session:null},error:new Tt}}catch(e){if(_t(e))return{data:{user:null,session:null},error:e};throw e}})}signInWithOAuth(t){return e(this,null,function*(){var e,s,r,n;return yield this._handleProviderSignIn(t.provider,{redirectTo:null===(e=t.options)||void 0===e?void 0:e.redirectTo,scopes:null===(s=t.options)||void 0===s?void 0:s.scopes,queryParams:null===(r=t.options)||void 0===r?void 0:r.queryParams,skipBrowserRedirect:null===(n=t.options)||void 0===n?void 0:n.skipBrowserRedirect})})}exchangeCodeForSession(t){return e(this,null,function*(){return yield this.initializePromise,this._acquireLock(-1,()=>e(this,null,function*(){return this._exchangeCodeForSession(t)}))})}signInWithWeb3(t){return e(this,null,function*(){const{chain:e}=t;if("solana"===e)return yield this.signInWithSolana(t);throw new Error(`@supabase/auth-js: Unsupported chain "${e}"`)})}signInWithSolana(t){return e(this,null,function*(){var e,s,r,n,i,o,a,l,u,h,c,d;let f,p;if("message"in t)f=t.message,p=t.signature;else{const{chain:c,wallet:d,statement:g,options:y}=t;let v;if(Ft())if("object"==typeof d)v=d;else{const e=window;if(!("solana"in e)||"object"!=typeof e.solana||!("signIn"in e.solana&&"function"==typeof e.solana.signIn||"signMessage"in e.solana&&"function"==typeof e.solana.signMessage))throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.");v=e.solana}else{if("object"!=typeof d||!(null==y?void 0:y.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");v=d}const m=new URL(null!==(e=null==y?void 0:y.url)&&void 0!==e?e:window.location.href);if("signIn"in v&&v.signIn){const e=yield v.signIn(Object.assign(Object.assign(Object.assign({issuedAt:(new Date).toISOString()},null==y?void 0:y.signInWithSolana),{version:"1",domain:m.host,uri:m.href}),g?{statement:g}:null));let t;if(Array.isArray(e)&&e[0]&&"object"==typeof e[0])t=e[0];else{if(!(e&&"object"==typeof e&&"signedMessage"in e&&"signature"in e))throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");t=e}if(!("signedMessage"in t&&"signature"in t&&("string"==typeof t.signedMessage||t.signedMessage instanceof Uint8Array)&&t.signature instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields");f="string"==typeof t.signedMessage?t.signedMessage:(new TextDecoder).decode(t.signedMessage),p=t.signature}else{if(!("signMessage"in v&&"function"==typeof v.signMessage&&"publicKey"in v&&"object"==typeof v&&v.publicKey&&"toBase58"in v.publicKey&&"function"==typeof v.publicKey.toBase58))throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");f=[`${m.host} wants you to sign in with your Solana account:`,v.publicKey.toBase58(),...g?["",g,""]:[""],"Version: 1",`URI: ${m.href}`,`Issued At: ${null!==(r=null===(s=null==y?void 0:y.signInWithSolana)||void 0===s?void 0:s.issuedAt)&&void 0!==r?r:(new Date).toISOString()}`,...(null===(n=null==y?void 0:y.signInWithSolana)||void 0===n?void 0:n.notBefore)?[`Not Before: ${y.signInWithSolana.notBefore}`]:[],...(null===(i=null==y?void 0:y.signInWithSolana)||void 0===i?void 0:i.expirationTime)?[`Expiration Time: ${y.signInWithSolana.expirationTime}`]:[],...(null===(o=null==y?void 0:y.signInWithSolana)||void 0===o?void 0:o.chainId)?[`Chain ID: ${y.signInWithSolana.chainId}`]:[],...(null===(a=null==y?void 0:y.signInWithSolana)||void 0===a?void 0:a.nonce)?[`Nonce: ${y.signInWithSolana.nonce}`]:[],...(null===(l=null==y?void 0:y.signInWithSolana)||void 0===l?void 0:l.requestId)?[`Request ID: ${y.signInWithSolana.requestId}`]:[],...(null===(h=null===(u=null==y?void 0:y.signInWithSolana)||void 0===u?void 0:u.resources)||void 0===h?void 0:h.length)?["Resources",...y.signInWithSolana.resources.map(e=>`- ${e}`)]:[]].join("\n");const e=yield v.signMessage((new TextEncoder).encode(f),"utf8");if(!(e&&e instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");p=e}}try{const{data:e,error:s}=yield as(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:f,signature:Mt(p)},(null===(c=t.options)||void 0===c?void 0:c.captchaToken)?{gotrue_meta_security:{captcha_token:null===(d=t.options)||void 0===d?void 0:d.captchaToken}}:null),xform:ls});if(s)throw s;return e&&e.session&&e.user?(e.session&&(yield this._saveSession(e.session),yield this._notifyAllSubscribers("SIGNED_IN",e.session)),{data:Object.assign({},e),error:s}):{data:{user:null,session:null},error:new Tt}}catch(g){if(_t(g))return{data:{user:null,session:null},error:g};throw g}})}_exchangeCodeForSession(t){return e(this,null,function*(){const e=yield Ht(this.storage,`${this.storageKey}-code-verifier`),[s,r]=(null!=e?e:"").split("/");try{const{data:e,error:n}=yield as(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:t,code_verifier:s},xform:ls});if(yield Gt(this.storage,`${this.storageKey}-code-verifier`),n)throw n;return e&&e.session&&e.user?(e.session&&(yield this._saveSession(e.session),yield this._notifyAllSubscribers("SIGNED_IN",e.session)),{data:Object.assign(Object.assign({},e),{redirectType:null!=r?r:null}),error:n}):{data:{user:null,session:null,redirectType:null},error:new Tt}}catch(n){if(_t(n))return{data:{user:null,session:null,redirectType:null},error:n};throw n}})}signInWithIdToken(t){return e(this,null,function*(){try{const{options:e,provider:s,token:r,access_token:n,nonce:i}=t,o=yield as(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:s,id_token:r,access_token:n,nonce:i,gotrue_meta_security:{captcha_token:null==e?void 0:e.captchaToken}},xform:ls}),{data:a,error:l}=o;return l?{data:{user:null,session:null},error:l}:a&&a.session&&a.user?(a.session&&(yield this._saveSession(a.session),yield this._notifyAllSubscribers("SIGNED_IN",a.session)),{data:a,error:l}):{data:{user:null,session:null},error:new Tt}}catch(e){if(_t(e))return{data:{user:null,session:null},error:e};throw e}})}signInWithOtp(t){return e(this,null,function*(){var e,s,r,n,i;try{if("email"in t){const{email:r,options:n}=t;let i=null,o=null;"pkce"===this.flowType&&([i,o]=yield Zt(this.storage,this.storageKey));const{error:a}=yield as(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:r,data:null!==(e=null==n?void 0:n.data)&&void 0!==e?e:{},create_user:null===(s=null==n?void 0:n.shouldCreateUser)||void 0===s||s,gotrue_meta_security:{captcha_token:null==n?void 0:n.captchaToken},code_challenge:i,code_challenge_method:o},redirectTo:null==n?void 0:n.emailRedirectTo});return{data:{user:null,session:null},error:a}}if("phone"in t){const{phone:e,options:s}=t,{data:o,error:a}=yield as(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:e,data:null!==(r=null==s?void 0:s.data)&&void 0!==r?r:{},create_user:null===(n=null==s?void 0:s.shouldCreateUser)||void 0===n||n,gotrue_meta_security:{captcha_token:null==s?void 0:s.captchaToken},channel:null!==(i=null==s?void 0:s.channel)&&void 0!==i?i:"sms"}});return{data:{user:null,session:null,messageId:null==o?void 0:o.message_id},error:a}}throw new jt("You must provide either an email or phone number.")}catch(o){if(_t(o))return{data:{user:null,session:null},error:o};throw o}})}verifyOtp(t){return e(this,null,function*(){var e,s;try{let r,n;"options"in t&&(r=null===(e=t.options)||void 0===e?void 0:e.redirectTo,n=null===(s=t.options)||void 0===s?void 0:s.captchaToken);const{data:i,error:o}=yield as(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},t),{gotrue_meta_security:{captcha_token:n}}),redirectTo:r,xform:ls});if(o)throw o;if(!i)throw new Error("An error occurred on token verification.");const a=i.session,l=i.user;return(null==a?void 0:a.access_token)&&(yield this._saveSession(a),yield this._notifyAllSubscribers("recovery"==t.type?"PASSWORD_RECOVERY":"SIGNED_IN",a)),{data:{user:l,session:a},error:null}}catch(r){if(_t(r))return{data:{user:null,session:null},error:r};throw r}})}signInWithSSO(t){return e(this,null,function*(){var e,s,r;try{let n=null,i=null;return"pkce"===this.flowType&&([n,i]=yield Zt(this.storage,this.storageKey)),yield as(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in t?{provider_id:t.providerId}:null),"domain"in t?{domain:t.domain}:null),{redirect_to:null!==(s=null===(e=t.options)||void 0===e?void 0:e.redirectTo)&&void 0!==s?s:void 0}),(null===(r=null==t?void 0:t.options)||void 0===r?void 0:r.captchaToken)?{gotrue_meta_security:{captcha_token:t.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:n,code_challenge_method:i}),headers:this.headers,xform:cs})}catch(n){if(_t(n))return{data:null,error:n};throw n}})}reauthenticate(){return e(this,null,function*(){return yield this.initializePromise,yield this._acquireLock(-1,()=>e(this,null,function*(){return yield this._reauthenticate()}))})}_reauthenticate(){return e(this,null,function*(){try{return yield this._useSession(t=>e(this,null,function*(){const{data:{session:e},error:s}=t;if(s)throw s;if(!e)throw new St;const{error:r}=yield as(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:e.access_token});return{data:{user:null,session:null},error:r}}))}catch(t){if(_t(t))return{data:{user:null,session:null},error:t};throw t}})}resend(t){return e(this,null,function*(){try{const e=`${this.url}/resend`;if("email"in t){const{email:s,type:r,options:n}=t,{error:i}=yield as(this.fetch,"POST",e,{headers:this.headers,body:{email:s,type:r,gotrue_meta_security:{captcha_token:null==n?void 0:n.captchaToken}},redirectTo:null==n?void 0:n.emailRedirectTo});return{data:{user:null,session:null},error:i}}if("phone"in t){const{phone:s,type:r,options:n}=t,{data:i,error:o}=yield as(this.fetch,"POST",e,{headers:this.headers,body:{phone:s,type:r,gotrue_meta_security:{captcha_token:null==n?void 0:n.captchaToken}}});return{data:{user:null,session:null,messageId:null==i?void 0:i.message_id},error:o}}throw new jt("You must provide either an email or phone number and a type")}catch(e){if(_t(e))return{data:{user:null,session:null},error:e};throw e}})}getSession(){return e(this,null,function*(){yield this.initializePromise;return yield this._acquireLock(-1,()=>e(this,null,function*(){return this._useSession(t=>e(this,null,function*(){return t}))}))})}_acquireLock(t,s){return e(this,null,function*(){this._debug("#_acquireLock","begin",t);try{if(this.lockAcquired){const t=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),r=(()=>e(this,null,function*(){return yield t,yield s()}))();return this.pendingInLock.push((()=>e(this,null,function*(){try{yield r}catch(e){}}))()),r}return yield this.lock(`lock:${this.storageKey}`,t,()=>e(this,null,function*(){this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const t=s();for(this.pendingInLock.push((()=>e(this,null,function*(){try{yield t}catch(e){}}))()),yield t;this.pendingInLock.length;){const e=[...this.pendingInLock];yield Promise.all(e),this.pendingInLock.splice(0,e.length)}return yield t}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}}))}finally{this._debug("#_acquireLock","end")}})}_useSession(t){return e(this,null,function*(){this._debug("#_useSession","begin");try{const e=yield this.__loadSession();return yield t(e)}finally{this._debug("#_useSession","end")}})}__loadSession(){return e(this,null,function*(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",(new Error).stack);try{let e=null;const t=yield Ht(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),null!==t&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),yield this._removeSession())),!e)return{data:{session:null},error:null};const s=!!e.expires_at&&1e3*e.expires_at-Date.now()<ft;if(this._debug("#__loadSession()",`session has${s?"":" not"} expired`,"expires_at",e.expires_at),!s){if(this.userStorage){const t=yield Ht(this.userStorage,this.storageKey+"-user");(null==t?void 0:t.user)?e.user=t.user:e.user=rs()}if(this.storage.isServer&&e.user){let t=this.suppressGetSessionWarning;e=new Proxy(e,{get:(e,s,r)=>(t||"user"!==s||(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),t=!0,this.suppressGetSessionWarning=!0),Reflect.get(e,s,r))})}return{data:{session:e},error:null}}const{session:r,error:n}=yield this._callRefreshToken(e.refresh_token);return n?{data:{session:null},error:n}:{data:{session:r},error:null}}finally{this._debug("#__loadSession()","end")}})}getUser(t){return e(this,null,function*(){if(t)return yield this._getUser(t);yield this.initializePromise;return yield this._acquireLock(-1,()=>e(this,null,function*(){return yield this._getUser()}))})}_getUser(t){return e(this,null,function*(){try{return t?yield as(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:t,xform:hs}):yield this._useSession(t=>e(this,null,function*(){var e,s,r;const{data:n,error:i}=t;if(i)throw i;return(null===(e=n.session)||void 0===e?void 0:e.access_token)||this.hasCustomAuthorizationHeader?yield as(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:null!==(r=null===(s=n.session)||void 0===s?void 0:s.access_token)&&void 0!==r?r:void 0,xform:hs}):{data:{user:null},error:new St}}))}catch(s){if(_t(s))return function(e){return _t(e)&&"AuthSessionMissingError"===e.name}(s)&&(yield this._removeSession(),yield Gt(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:s};throw s}})}updateUser(t){return e(this,arguments,function*(t,s={}){return yield this.initializePromise,yield this._acquireLock(-1,()=>e(this,null,function*(){return yield this._updateUser(t,s)}))})}_updateUser(t){return e(this,arguments,function*(t,s={}){try{return yield this._useSession(r=>e(this,null,function*(){const{data:e,error:n}=r;if(n)throw n;if(!e.session)throw new St;const i=e.session;let o=null,a=null;"pkce"===this.flowType&&null!=t.email&&([o,a]=yield Zt(this.storage,this.storageKey));const{data:l,error:u}=yield as(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:null==s?void 0:s.emailRedirectTo,body:Object.assign(Object.assign({},t),{code_challenge:o,code_challenge_method:a}),jwt:i.access_token,xform:hs});if(u)throw u;return i.user=l.user,yield this._saveSession(i),yield this._notifyAllSubscribers("USER_UPDATED",i),{data:{user:i.user},error:null}}))}catch(r){if(_t(r))return{data:{user:null},error:r};throw r}})}setSession(t){return e(this,null,function*(){return yield this.initializePromise,yield this._acquireLock(-1,()=>e(this,null,function*(){return yield this._setSession(t)}))})}_setSession(t){return e(this,null,function*(){try{if(!t.access_token||!t.refresh_token)throw new St;const e=Date.now()/1e3;let s=e,r=!0,n=null;const{payload:i}=Yt(t.access_token);if(i.exp&&(s=i.exp,r=s<=e),r){const{session:e,error:s}=yield this._callRefreshToken(t.refresh_token);if(s)return{data:{user:null,session:null},error:s};if(!e)return{data:{user:null,session:null},error:null};n=e}else{const{data:r,error:i}=yield this._getUser(t.access_token);if(i)throw i;n={access_token:t.access_token,refresh_token:t.refresh_token,user:r.user,token_type:"bearer",expires_in:s-e,expires_at:s},yield this._saveSession(n),yield this._notifyAllSubscribers("SIGNED_IN",n)}return{data:{user:n.user,session:n},error:null}}catch(e){if(_t(e))return{data:{session:null,user:null},error:e};throw e}})}refreshSession(t){return e(this,null,function*(){return yield this.initializePromise,yield this._acquireLock(-1,()=>e(this,null,function*(){return yield this._refreshSession(t)}))})}_refreshSession(t){return e(this,null,function*(){try{return yield this._useSession(s=>e(this,null,function*(){var e;if(!t){const{data:r,error:n}=s;if(n)throw n;t=null!==(e=r.session)&&void 0!==e?e:void 0}if(!(null==t?void 0:t.refresh_token))throw new St;const{session:r,error:n}=yield this._callRefreshToken(t.refresh_token);return n?{data:{user:null,session:null},error:n}:r?{data:{user:r.user,session:r},error:null}:{data:{user:null,session:null},error:null}}))}catch(s){if(_t(s))return{data:{user:null,session:null},error:s};throw s}})}_getSessionFromURL(t,s){return e(this,null,function*(){try{if(!Ft())throw new Et("No browser detected.");if(t.error||t.error_description||t.error_code)throw new Et(t.error_description||"Error in URL with unspecified error_description",{error:t.error||"unspecified_error",code:t.error_code||"unspecified_code"});switch(s){case"implicit":if("pkce"===this.flowType)throw new Pt("Not a valid PKCE flow url.");break;case"pkce":if("implicit"===this.flowType)throw new Et("Not a valid implicit grant flow url.")}if("pkce"===s){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!t.code)throw new Pt("No code detected.");const{data:e,error:s}=yield this._exchangeCodeForSession(t.code);if(s)throw s;const r=new URL(window.location.href);return r.searchParams.delete("code"),window.history.replaceState(window.history.state,"",r.toString()),{data:{session:e.session,redirectType:null},error:null}}const{provider_token:e,provider_refresh_token:r,access_token:n,refresh_token:i,expires_in:o,expires_at:a,token_type:l}=t;if(!(n&&o&&i&&l))throw new Et("No session defined in URL");const u=Math.round(Date.now()/1e3),h=parseInt(o);let c=u+h;a&&(c=parseInt(a));const d=c-u;1e3*d<=dt&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${d}s, should have been closer to ${h}s`);const f=c-h;u-f>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",f,c,u):u-f<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",f,c,u);const{data:p,error:g}=yield this._getUser(n);if(g)throw g;const y={provider_token:e,provider_refresh_token:r,access_token:n,expires_in:h,expires_at:c,refresh_token:i,token_type:l,user:p.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:y,redirectType:t.type},error:null}}catch(e){if(_t(e))return{data:{session:null,redirectType:null},error:e};throw e}})}_isImplicitGrantCallback(e){return Boolean(e.access_token||e.error_description)}_isPKCECallback(t){return e(this,null,function*(){const e=yield Ht(this.storage,`${this.storageKey}-code-verifier`);return!(!t.code||!e)})}signOut(){return e(this,arguments,function*(t={scope:"global"}){return yield this.initializePromise,yield this._acquireLock(-1,()=>e(this,null,function*(){return yield this._signOut(t)}))})}_signOut(){return e(this,arguments,function*({scope:t}={scope:"global"}){return yield this._useSession(s=>e(this,null,function*(){var e;const{data:r,error:n}=s;if(n)return{error:n};const i=null===(e=r.session)||void 0===e?void 0:e.access_token;if(i){const{error:e}=yield this.admin.signOut(i,t);if(e&&(!function(e){return _t(e)&&"AuthApiError"===e.name}(e)||404!==e.status&&401!==e.status&&403!==e.status))return{error:e}}return"others"!==t&&(yield this._removeSession(),yield Gt(this.storage,`${this.storageKey}-code-verifier`)),{error:null}}))})}onAuthStateChange(t){const s="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){const t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}),r={id:s,callback:t,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",s),this.stateChangeEmitters.delete(s)}};return this._debug("#onAuthStateChange()","registered callback with id",s),this.stateChangeEmitters.set(s,r),(()=>{e(this,null,function*(){yield this.initializePromise,yield this._acquireLock(-1,()=>e(this,null,function*(){this._emitInitialSession(s)}))})})(),{data:{subscription:r}}}_emitInitialSession(t){return e(this,null,function*(){return yield this._useSession(s=>e(this,null,function*(){var e,r;try{const{data:{session:r},error:n}=s;if(n)throw n;yield null===(e=this.stateChangeEmitters.get(t))||void 0===e?void 0:e.callback("INITIAL_SESSION",r),this._debug("INITIAL_SESSION","callback id",t,"session",r)}catch(n){yield null===(r=this.stateChangeEmitters.get(t))||void 0===r?void 0:r.callback("INITIAL_SESSION",null),this._debug("INITIAL_SESSION","callback id",t,"error",n),console.error(n)}}))})}resetPasswordForEmail(t){return e(this,arguments,function*(e,t={}){let s=null,r=null;"pkce"===this.flowType&&([s,r]=yield Zt(this.storage,this.storageKey,!0));try{return yield as(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:s,code_challenge_method:r,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(n){if(_t(n))return{data:null,error:n};throw n}})}getUserIdentities(){return e(this,null,function*(){var e;try{const{data:t,error:s}=yield this.getUser();if(s)throw s;return{data:{identities:null!==(e=t.user.identities)&&void 0!==e?e:[]},error:null}}catch(t){if(_t(t))return{data:null,error:t};throw t}})}linkIdentity(t){return e(this,null,function*(){var s;try{const{data:r,error:n}=yield this._useSession(s=>e(this,null,function*(){var e,r,n,i,o;const{data:a,error:l}=s;if(l)throw l;const u=yield this._getUrlForProvider(`${this.url}/user/identities/authorize`,t.provider,{redirectTo:null===(e=t.options)||void 0===e?void 0:e.redirectTo,scopes:null===(r=t.options)||void 0===r?void 0:r.scopes,queryParams:null===(n=t.options)||void 0===n?void 0:n.queryParams,skipBrowserRedirect:!0});return yield as(this.fetch,"GET",u,{headers:this.headers,jwt:null!==(o=null===(i=a.session)||void 0===i?void 0:i.access_token)&&void 0!==o?o:void 0})}));if(n)throw n;return Ft()&&!(null===(s=t.options)||void 0===s?void 0:s.skipBrowserRedirect)&&window.location.assign(null==r?void 0:r.url),{data:{provider:t.provider,url:null==r?void 0:r.url},error:null}}catch(r){if(_t(r))return{data:{provider:t.provider,url:null},error:r};throw r}})}unlinkIdentity(t){return e(this,null,function*(){try{return yield this._useSession(s=>e(this,null,function*(){var e,r;const{data:n,error:i}=s;if(i)throw i;return yield as(this.fetch,"DELETE",`${this.url}/user/identities/${t.identity_id}`,{headers:this.headers,jwt:null!==(r=null===(e=n.session)||void 0===e?void 0:e.access_token)&&void 0!==r?r:void 0})}))}catch(s){if(_t(s))return{data:null,error:s};throw s}})}_refreshAccessToken(t){return e(this,null,function*(){const s=`#_refreshAccessToken(${t.substring(0,5)}...)`;this._debug(s,"begin");try{const i=Date.now();return yield(r=r=>e(this,null,function*(){return r>0&&(yield function(t){return e(this,null,function*(){return yield new Promise(e=>{setTimeout(()=>e(null),t)})})}(200*Math.pow(2,r-1))),this._debug(s,"refreshing attempt",r),yield as(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:t},headers:this.headers,xform:ls})}),n=(e,t)=>{const s=200*Math.pow(2,e);return t&&$t(t)&&Date.now()+s-i<dt},new Promise((t,s)=>{e(null,null,function*(){for(let i=0;i<1/0;i++)try{const e=yield r(i);if(!n(i,null,e))return void t(e)}catch(e){if(!n(i,e))return void s(e)}})}))}catch(i){if(this._debug(s,"error",i),_t(i))return{data:{session:null,user:null},error:i};throw i}finally{this._debug(s,"end")}var r,n})}_isValidSession(e){return"object"==typeof e&&null!==e&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}_handleProviderSignIn(t,s){return e(this,null,function*(){const e=yield this._getUrlForProvider(`${this.url}/authorize`,t,{redirectTo:s.redirectTo,scopes:s.scopes,queryParams:s.queryParams});return this._debug("#_handleProviderSignIn()","provider",t,"options",s,"url",e),Ft()&&!s.skipBrowserRedirect&&window.location.assign(e),{data:{provider:t,url:e},error:null}})}_recoverAndRefresh(){return e(this,null,function*(){var e,t;const s="#_recoverAndRefresh()";this._debug(s,"begin");try{const n=yield Ht(this.storage,this.storageKey);if(n&&this.userStorage){let t=yield Ht(this.userStorage,this.storageKey+"-user");this.storage.isServer||!Object.is(this.storage,this.userStorage)||t||(t={user:n.user},yield Jt(this.userStorage,this.storageKey+"-user",t)),n.user=null!==(e=null==t?void 0:t.user)&&void 0!==e?e:rs()}else if(n&&!n.user&&!n.user){const e=yield Ht(this.storage,this.storageKey+"-user");e&&(null==e?void 0:e.user)?(n.user=e.user,yield Gt(this.storage,this.storageKey+"-user"),yield Jt(this.storage,this.storageKey,n)):n.user=rs()}if(this._debug(s,"session from storage",n),!this._isValidSession(n))return this._debug(s,"session is not valid"),void(null!==n&&(yield this._removeSession()));const i=1e3*(null!==(t=n.expires_at)&&void 0!==t?t:1/0)-Date.now()<ft;if(this._debug(s,`session has${i?"":" not"} expired with margin of 90000s`),i){if(this.autoRefreshToken&&n.refresh_token){const{error:e}=yield this._callRefreshToken(n.refresh_token);e&&(console.error(e),$t(e)||(this._debug(s,"refresh failed with a non-retryable error, removing the session",e),yield this._removeSession()))}}else if(n.user&&!0===n.user.__isUserNotAvailableProxy)try{const{data:e,error:t}=yield this._getUser(n.access_token);!t&&(null==e?void 0:e.user)?(n.user=e.user,yield this._saveSession(n),yield this._notifyAllSubscribers("SIGNED_IN",n)):this._debug(s,"could not get user data, skipping SIGNED_IN notification")}catch(r){console.error("Error getting user data:",r),this._debug(s,"error getting user data, skipping SIGNED_IN notification",r)}else yield this._notifyAllSubscribers("SIGNED_IN",n)}catch(n){return this._debug(s,"error",n),void console.error(n)}finally{this._debug(s,"end")}})}_callRefreshToken(t){return e(this,null,function*(){var e,s;if(!t)throw new St;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const r=`#_callRefreshToken(${t.substring(0,5)}...)`;this._debug(r,"begin");try{this.refreshingDeferred=new Vt;const{data:e,error:s}=yield this._refreshAccessToken(t);if(s)throw s;if(!e.session)throw new St;yield this._saveSession(e.session),yield this._notifyAllSubscribers("TOKEN_REFRESHED",e.session);const r={session:e.session,error:null};return this.refreshingDeferred.resolve(r),r}catch(n){if(this._debug(r,"error",n),_t(n)){const t={session:null,error:n};return $t(n)||(yield this._removeSession()),null===(e=this.refreshingDeferred)||void 0===e||e.resolve(t),t}throw null===(s=this.refreshingDeferred)||void 0===s||s.reject(n),n}finally{this.refreshingDeferred=null,this._debug(r,"end")}})}_notifyAllSubscribers(t,s,r=!0){return e(this,null,function*(){const n=`#_notifyAllSubscribers(${t})`;this._debug(n,"begin",s,`broadcast = ${r}`);try{this.broadcastChannel&&r&&this.broadcastChannel.postMessage({event:t,session:s});const n=[],i=Array.from(this.stateChangeEmitters.values()).map(r=>e(this,null,function*(){try{yield r.callback(t,s)}catch(e){n.push(e)}}));if(yield Promise.all(i),n.length>0){for(let e=0;e<n.length;e+=1)console.error(n[e]);throw n[0]}}finally{this._debug(n,"end")}})}_saveSession(t){return e(this,null,function*(){this._debug("#_saveSession()",t),this.suppressGetSessionWarning=!0;const e=Object.assign({},t),s=e.user&&!0===e.user.__isUserNotAvailableProxy;if(this.userStorage){!s&&e.user&&(yield Jt(this.userStorage,this.storageKey+"-user",{user:e.user}));const t=Object.assign({},e);delete t.user;const r=structuredClone(t);yield Jt(this.storage,this.storageKey,r)}else{const t=structuredClone(e);yield Jt(this.storage,this.storageKey,t)}})}_removeSession(){return e(this,null,function*(){this._debug("#_removeSession()"),yield Gt(this.storage,this.storageKey),yield Gt(this.storage,this.storageKey+"-code-verifier"),yield Gt(this.storage,this.storageKey+"-user"),this.userStorage&&(yield Gt(this.userStorage,this.storageKey+"-user")),yield this._notifyAllSubscribers("SIGNED_OUT",null)})}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&Ft()&&(null===window||void 0===window?void 0:window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}_startAutoRefresh(){return e(this,null,function*(){yield this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const t=setInterval(()=>this._autoRefreshTokenTick(),dt);this.autoRefreshTicker=t,t&&"object"==typeof t&&"function"==typeof t.unref?t.unref():"undefined"!=typeof Deno&&"function"==typeof Deno.unrefTimer&&Deno.unrefTimer(t),setTimeout(()=>e(this,null,function*(){yield this.initializePromise,yield this._autoRefreshTokenTick()}),0)})}_stopAutoRefresh(){return e(this,null,function*(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)})}startAutoRefresh(){return e(this,null,function*(){this._removeVisibilityChangedCallback(),yield this._startAutoRefresh()})}stopAutoRefresh(){return e(this,null,function*(){this._removeVisibilityChangedCallback(),yield this._stopAutoRefresh()})}_autoRefreshTokenTick(){return e(this,null,function*(){this._debug("#_autoRefreshTokenTick()","begin");try{yield this._acquireLock(0,()=>e(this,null,function*(){try{const s=Date.now();try{return yield this._useSession(t=>e(this,null,function*(){const{data:{session:e}}=t;if(!e||!e.refresh_token||!e.expires_at)return void this._debug("#_autoRefreshTokenTick()","no session");const r=Math.floor((1e3*e.expires_at-s)/dt);this._debug("#_autoRefreshTokenTick()",`access token expires in ${r} ticks, a tick lasts 30000ms, refresh threshold is 3 ticks`),r<=3&&(yield this._callRefreshToken(e.refresh_token))}))}catch(t){console.error("Auto refresh tick failed with error. This is likely a transient error.",t)}}finally{this._debug("#_autoRefreshTokenTick()","end")}}))}catch(t){if(!(t.isAcquireTimeout||t instanceof ms))throw t;this._debug("auto refresh token tick lock not available")}})}_handleVisibilityChange(){return e(this,null,function*(){if(this._debug("#_handleVisibilityChange()"),!Ft()||!(null===window||void 0===window?void 0:window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=()=>e(this,null,function*(){return yield this._onVisibilityChanged(!1)}),null===window||void 0===window||window.addEventListener("visibilitychange",this.visibilityChangedCallback),yield this._onVisibilityChanged(!0)}catch(t){console.error("_handleVisibilityChange",t)}})}_onVisibilityChanged(t){return e(this,null,function*(){const s=`#_onVisibilityChanged(${t})`;this._debug(s,"visibilityState",document.visibilityState),"visible"===document.visibilityState?(this.autoRefreshToken&&this._startAutoRefresh(),t||(yield this.initializePromise,yield this._acquireLock(-1,()=>e(this,null,function*(){"visible"===document.visibilityState?yield this._recoverAndRefresh():this._debug(s,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting")})))):"hidden"===document.visibilityState&&this.autoRefreshToken&&this._stopAutoRefresh()})}_getUrlForProvider(t,s,r){return e(this,null,function*(){const e=[`provider=${encodeURIComponent(s)}`];if((null==r?void 0:r.redirectTo)&&e.push(`redirect_to=${encodeURIComponent(r.redirectTo)}`),(null==r?void 0:r.scopes)&&e.push(`scopes=${encodeURIComponent(r.scopes)}`),"pkce"===this.flowType){const[t,s]=yield Zt(this.storage,this.storageKey),r=new URLSearchParams({code_challenge:`${encodeURIComponent(t)}`,code_challenge_method:`${encodeURIComponent(s)}`});e.push(r.toString())}if(null==r?void 0:r.queryParams){const t=new URLSearchParams(r.queryParams);e.push(t.toString())}return(null==r?void 0:r.skipBrowserRedirect)&&e.push(`skip_http_redirect=${r.skipBrowserRedirect}`),`${t}?${e.join("&")}`})}_unenroll(t){return e(this,null,function*(){try{return yield this._useSession(s=>e(this,null,function*(){var e;const{data:r,error:n}=s;return n?{data:null,error:n}:yield as(this.fetch,"DELETE",`${this.url}/factors/${t.factorId}`,{headers:this.headers,jwt:null===(e=null==r?void 0:r.session)||void 0===e?void 0:e.access_token})}))}catch(s){if(_t(s))return{data:null,error:s};throw s}})}_enroll(t){return e(this,null,function*(){try{return yield this._useSession(s=>e(this,null,function*(){var e,r;const{data:n,error:i}=s;if(i)return{data:null,error:i};const o=Object.assign({friendly_name:t.friendlyName,factor_type:t.factorType},"phone"===t.factorType?{phone:t.phone}:{issuer:t.issuer}),{data:a,error:l}=yield as(this.fetch,"POST",`${this.url}/factors`,{body:o,headers:this.headers,jwt:null===(e=null==n?void 0:n.session)||void 0===e?void 0:e.access_token});return l?{data:null,error:l}:("totp"===t.factorType&&(null===(r=null==a?void 0:a.totp)||void 0===r?void 0:r.qr_code)&&(a.totp.qr_code=`data:image/svg+xml;utf-8,${a.totp.qr_code}`),{data:a,error:null})}))}catch(s){if(_t(s))return{data:null,error:s};throw s}})}_verify(t){return e(this,null,function*(){return this._acquireLock(-1,()=>e(this,null,function*(){try{return yield this._useSession(s=>e(this,null,function*(){var e;const{data:r,error:n}=s;if(n)return{data:null,error:n};const{data:i,error:o}=yield as(this.fetch,"POST",`${this.url}/factors/${t.factorId}/verify`,{body:{code:t.code,challenge_id:t.challengeId},headers:this.headers,jwt:null===(e=null==r?void 0:r.session)||void 0===e?void 0:e.access_token});return o?{data:null,error:o}:(yield this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+i.expires_in},i)),yield this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",i),{data:i,error:o})}))}catch(s){if(_t(s))return{data:null,error:s};throw s}}))})}_challenge(t){return e(this,null,function*(){return this._acquireLock(-1,()=>e(this,null,function*(){try{return yield this._useSession(s=>e(this,null,function*(){var e;const{data:r,error:n}=s;return n?{data:null,error:n}:yield as(this.fetch,"POST",`${this.url}/factors/${t.factorId}/challenge`,{body:{channel:t.channel},headers:this.headers,jwt:null===(e=null==r?void 0:r.session)||void 0===e?void 0:e.access_token})}))}catch(s){if(_t(s))return{data:null,error:s};throw s}}))})}_challengeAndVerify(t){return e(this,null,function*(){const{data:e,error:s}=yield this._challenge({factorId:t.factorId});return s?{data:null,error:s}:yield this._verify({factorId:t.factorId,challengeId:e.id,code:t.code})})}_listFactors(){return e(this,null,function*(){const{data:{user:e},error:t}=yield this.getUser();if(t)return{data:null,error:t};const s=(null==e?void 0:e.factors)||[],r=s.filter(e=>"totp"===e.factor_type&&"verified"===e.status),n=s.filter(e=>"phone"===e.factor_type&&"verified"===e.status);return{data:{all:s,totp:r,phone:n},error:null}})}_getAuthenticatorAssuranceLevel(){return e(this,null,function*(){return this._acquireLock(-1,()=>e(this,null,function*(){return yield this._useSession(t=>e(this,null,function*(){var e,s;const{data:{session:r},error:n}=t;if(n)return{data:null,error:n};if(!r)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:i}=Yt(r.access_token);let o=null;i.aal&&(o=i.aal);let a=o;(null!==(s=null===(e=r.user.factors)||void 0===e?void 0:e.filter(e=>"verified"===e.status))&&void 0!==s?s:[]).length>0&&(a="aal2");return{data:{currentLevel:o,nextLevel:a,currentAuthenticationMethods:i.amr||[]},error:null}}))}))})}fetchJwk(t){return e(this,arguments,function*(e,t={keys:[]}){let s=t.keys.find(t=>t.kid===e);if(s)return s;const r=Date.now();if(s=this.jwks.keys.find(t=>t.kid===e),s&&this.jwks_cached_at+6e5>r)return s;const{data:n,error:i}=yield as(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(i)throw i;return n.keys&&0!==n.keys.length?(this.jwks=n,this.jwks_cached_at=r,s=n.keys.find(t=>t.kid===e),s||null):null})}getClaims(t){return e(this,arguments,function*(e,t={}){try{let s=e;if(!s){const{data:e,error:t}=yield this.getSession();if(t||!e.session)return{data:null,error:t};s=e.session.access_token}const{header:r,payload:n,signature:i,raw:{header:o,payload:a}}=Yt(s);(null==t?void 0:t.allowExpired)||function(e){if(!e)throw new Error("Missing exp claim");if(e<=Math.floor(Date.now()/1e3))throw new Error("JWT has expired")}(n.exp);const l=r.alg&&!r.alg.startsWith("HS")&&r.kid&&"crypto"in globalThis&&"subtle"in globalThis.crypto?yield this.fetchJwk(r.kid,(null==t?void 0:t.keys)?{keys:t.keys}:null==t?void 0:t.jwks):null;if(!l){const{error:e}=yield this.getUser(s);if(e)throw e;return{data:{claims:n,header:r,signature:i},error:null}}const u=function(e){switch(e){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}(r.alg),h=yield crypto.subtle.importKey("jwk",l,u,!0,["verify"]);if(!(yield crypto.subtle.verify(u,h,i,Bt(`${o}.${a}`))))throw new Ct("Invalid JWT signature");return{data:{claims:n,header:r,signature:i},error:null}}catch(s){if(_t(s))return{data:null,error:s};throw s}})}}Ts.nextInstanceID=0;const js=Ts;class Es extends js{constructor(e){super(e)}}var Ps=function(e,t,s,r){return new(s||(s=Promise))(function(n,i){function o(e){try{l(r.next(e))}catch(t){i(t)}}function a(e){try{l(r.throw(e))}catch(t){i(t)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s(function(e){e(t)})).then(o,a)}l((r=r.apply(e,t||[])).next())})};class Os{constructor(e,t,s){var r,n,i;if(this.supabaseUrl=e,this.supabaseKey=t,!e)throw new Error("supabaseUrl is required.");if(!t)throw new Error("supabaseKey is required.");const o=(a=e).endsWith("/")?a:a+"/";var a;const l=new URL(o);this.realtimeUrl=new URL("realtime/v1",l),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",l),this.storageUrl=new URL("storage/v1",l),this.functionsUrl=new URL("functions/v1",l);const u=`sb-${l.hostname.split(".")[0]}-auth-token`,h=function(e,t){var s,r;const{db:n,auth:i,realtime:o,global:a}=e,{db:l,auth:u,realtime:h,global:c}=t,d={db:Object.assign(Object.assign({},l),n),auth:Object.assign(Object.assign({},u),i),realtime:Object.assign(Object.assign({},h),o),global:Object.assign(Object.assign(Object.assign({},c),a),{headers:Object.assign(Object.assign({},null!==(s=null==c?void 0:c.headers)&&void 0!==s?s:{}),null!==(r=null==a?void 0:a.headers)&&void 0!==r?r:{})}),accessToken:()=>ht(this,void 0,void 0,function*(){return""})};return e.accessToken?d.accessToken=e.accessToken:delete d.accessToken,d}(null!=s?s:{},{db:it,realtime:at,auth:Object.assign(Object.assign({},ot),{storageKey:u}),global:nt});this.storageKey=null!==(r=h.auth.storageKey)&&void 0!==r?r:"",this.headers=null!==(n=h.global.headers)&&void 0!==n?n:{},h.accessToken?(this.accessToken=h.accessToken,this.auth=new Proxy({},{get:(e,t)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(t)} is not possible`)}})):this.auth=this._initSupabaseAuthClient(null!==(i=h.auth)&&void 0!==i?i:{},this.headers,h.global.fetch),this.fetch=ut(t,this._getAccessToken.bind(this),h.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},h.realtime)),this.rest=new J(new URL("rest/v1",l).href,{headers:this.headers,schema:h.db.schema,fetch:this.fetch}),h.accessToken||this._listenForAuthEvents()}get functions(){return new d(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}get storage(){return new st(this.storageUrl.href,this.headers,this.fetch)}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},s={}){return this.rest.rpc(e,t,s)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,t;return Ps(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:s}=yield this.auth.getSession();return null!==(t=null===(e=s.session)||void 0===e?void 0:e.access_token)&&void 0!==t?t:null})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:s,storage:r,storageKey:n,flowType:i,lock:o,debug:a},l,u){const h={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new Es({url:this.authUrl.href,headers:Object.assign(Object.assign({},h),l),storageKey:n,autoRefreshToken:e,persistSession:t,detectSessionInUrl:s,storage:r,flowType:i,lock:o,debug:a,fetch:u,hasCustomAuthorizationHeader:"Authorization"in this.headers})}_initRealtimeClient(e){return new xe(this.realtimeUrl.href,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},null==e?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((e,t)=>{this._handleTokenChanged(e,"CLIENT",null==t?void 0:t.access_token)})}_handleTokenChanged(e,t,s){"TOKEN_REFRESHED"!==e&&"SIGNED_IN"!==e||this.changedAccessToken===s?"SIGNED_OUT"===e&&(this.realtime.setAuth(),"STORAGE"==t&&this.auth.signOut(),this.changedAccessToken=void 0):this.changedAccessToken=s}}const $s=(e,t,s)=>new Os(e,t,s);export{n as _,$s as c};
